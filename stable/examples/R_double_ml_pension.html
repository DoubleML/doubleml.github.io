
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>R: Impact of 401(k) on Financial Wealth &#8212; DoubleML  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=c49bcd98" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=1ecd1175"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/R_double_ml_pension';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.doubleml.org/dev/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'stable';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="R: DoubleML for Difference-in-Differences" href="R_double_ml_did.html" />
    <link rel="prev" title="R: Basics of Double Machine Learning" href="R_double_ml_basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">DoubleML's first user survey is live: <a href='https://forms.gle/HjZsWgrF5UEFUyDX9'> Share your feedback here!</a> (10-15 minutes)</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/logo_dark.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">DoubleML</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro/install.html">
     Install
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro/intro.html">
     Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../workflow/workflow.html">
     Workflow
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../guide/guide.html">
     User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
     Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/api.html">
     Python API
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://docs.doubleml.org/r/stable/">
     R API
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://docs.doubleml.org/doubleml-coverage/">
     Coverage Repository
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../literature/literature.html">
     Literature
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../release/release.html">
     Release notes
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DoubleML/doubleml-for-py" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/DoubleML/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DoubleML/doubleml-for-py/discussions" title="Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discussions</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro/install.html">
     Install
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../intro/intro.html">
     Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../workflow/workflow.html">
     Workflow
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../guide/guide.html">
     User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
     Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/api.html">
     Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://docs.doubleml.org/r/stable/">
     R API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://docs.doubleml.org/doubleml-coverage/">
     Coverage Repository
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../literature/literature.html">
     Literature
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../release/release.html">
     Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DoubleML/doubleml-for-py" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/DoubleML/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DoubleML/doubleml-for-py/discussions" title="Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discussions</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><p class="logo" style="text-align:center;"><a href="../index.html">
    <img class="logo" src="../logo.png" alt="Logo" width="65%" height="65%">
</a></p>

<script type="text/javascript">
    // Change the logo depending on the theme
    var logo = document.querySelector('img.logo');
    var observer = new MutationObserver(function(mutations) {
        const dark = document.documentElement.dataset.theme == 'dark';
        if (dark) {
            logo.src = "../logo_dark.png";
        } else {
            logo.src = "../logo.png";
        }
    });
    observer.observe(document.documentElement, {attributes: true, attributeFilter: ['data-theme']});
</script></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_basics.html">Python: Basics of Double Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_pension.html">Python: Impact of 401(k) on Financial Wealth</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_sensitivity.html">Python: Sensitivity Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_apo.html">Python: Average Potential Outcome (APO) Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_irm_vs_apo.html">Python: IRM and APO Model Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_lplr.html">Python: Log-Odds Effects for Logistic PLR models</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_ssm.html">Python: Sample Selection Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="learners/py_optuna.html">Python: Hyperparametertuning with Optuna</a></li>
<li class="toctree-l1"><a class="reference internal" href="learners/py_learner.html">Python: Choice of learners</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_firststage.html">Python: First Stage and Causal Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_multiway_cluster.html">Python: Cluster Robust Double Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_sensitivity_booking.html">Python: Sensitivity Analysis for Causal ML</a></li>




<li class="toctree-l1"><a class="reference internal" href="learners/py_tabpfn.html">Python: Causal Machine Learning with TabPFN</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_basic_iv.html">Python: Basic Instrumental Variables calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_robust_iv.html">Python: Confidence Intervals for Instrumental Variables Models That Are Robust to Weak Instruments</a></li>


<li class="toctree-l1"><a class="reference internal" href="py_double_ml_plm_irm_hetfx.html">Python: PLM and IRM for Multiple Treatments</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_meets_flaml.html">DoubleML meets FLAML - How to tune learners automatically within <code class="docutils literal notranslate"><span class="pre">DoubleML</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_rdflex.html">Flexible Covariate Adjustment in Regression Discontinuity Designs (RDD)</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_gate.html">Python: Group Average Treatment Effects (GATEs) for IRM models</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_gate_plr.html">Python: Group Average Treatment Effects (GATEs) for PLR models</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_cate.html">Python: Conditional Average Treatment Effects (CATEs) for IRM models</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_cate_plr.html">Python: Conditional Average Treatment Effects (CATEs) for PLR models</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_gate_sensitivity.html">Python: GATE Sensitivity Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_policy_tree.html">Python: Policy Learning with Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_pension_qte.html">Python: Impact of 401(k) on Financial Wealth (Quantile Effects)</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_pq.html">Python: Potential Quantiles and Quantile Treatment Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_cvar.html">Python: Conditional Value at Risk of potential outcomes</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="did/py_panel_simple.html">Python: Panel Data Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="did/py_panel.html">Python: Panel Data with Multiple Time Periods</a></li>
<li class="toctree-l1"><a class="reference internal" href="did/py_panel_data_example.html">Python: Real-Data Example for Multi-Period Difference-in-Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="did/py_rep_cs.html">Python: Repeated Cross-Sectional Data with Multiple Time Periods</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="R_double_ml_basics.html">R: Basics of Double Machine Learning</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">R: Impact of 401(k) on Financial Wealth</a></li>
<li class="toctree-l1"><a class="reference internal" href="R_double_ml_did.html">R: DoubleML for Difference-in-Differences</a></li>

<li class="toctree-l1"><a class="reference internal" href="R_double_ml_multiway_cluster.html">R: Cluster Robust Double Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="R_double_ml_ssm.html">R: Sample Selection Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="R_double_ml_basic_iv.html">R: Basic Instrumental Variables Calculation</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="R_double_ml_pipeline.html">R: Ensemble Learners and More with <code class="docutils literal notranslate"><span class="pre">mlr3pipelines</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="double_ml_bonus_data.html">DML: Bonus Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="did/py_did.html">Python: Difference-in-Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="did/py_did_pretest.html">Python: Difference-in-Differences Pre-Testing</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">R: Impact...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
      <div class="admonition note">
    <p class="admonition-title">Note</p>
    <ul class="simple">

Download Jupyter notebook:
<a class="reference external" href="https://docs.doubleml.org/stable/examples/R_double_ml_pension.ipynb">https://docs.doubleml.org/stable/examples/R_double_ml_pension.ipynb</a>.

    </ul>
    </div><section id="R:-Impact-of-401(k)-on-Financial-Wealth">
<h1>R: Impact of 401(k) on Financial Wealth<a class="headerlink" href="#R:-Impact-of-401(k)-on-Financial-Wealth" title="Link to this heading">#</a></h1>
<p>In this real-data example, we illustrate how the <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> package can be used to estimate the effect of 401(k) eligibility and participation on accumulated assets. The 401(k) data set has been analyzed in several studies, among others <a class="reference external" href="https://arxiv.org/abs/1608.00060">Chernozhukov et al. (2018)</a>.</p>
<p>401(k) plans are pension accounts sponsored by employers. The key problem in determining the effect of participation in 401(k) plans on accumulated assets is saver heterogeneity coupled with the fact that the decision to enroll in a 401(k) is non-random. It is generally recognized that some people have a higher preference for saving than others. It also seems likely that those individuals with high unobserved preference for saving would be most likely to choose to participate in tax-advantaged
retirement savings plans and would tend to have otherwise high amounts of accumulated assets. The presence of unobserved savings preferences with these properties then implies that conventional estimates that do not account for saver heterogeneity and endogeneity of participation will be biased upward, tending to overstate the savings effects of 401(k) participation.</p>
<p>One can argue that eligibility for enrolling in a 401(k) plan in this data can be taken as exogenous after conditioning on a few observables of which the most important for their argument is income. The basic idea is that, at least around the time 401(k)’s initially became available, people were unlikely to be basing their employment decisions on whether an employer offered a 401(k) but would instead focus on income and other aspects of the job.</p>
<section id="Data">
<h2>Data<a class="headerlink" href="#Data" title="Link to this heading">#</a></h2>
<p>The preprocessed data can be fetched by calling <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">fetch_401k()</a>. The arguments <code class="docutils literal notranslate"><span class="pre">polynomial_features</span></code> and <code class="docutils literal notranslate"><span class="pre">instrument</span></code> can be used to replicate the models used in <a class="reference external" href="https://arxiv.org/abs/1608.00060">Chernozhukov et al. (2018)</a>. Note that an internet connection is required for loading the data. We start with a baseline specification of the regression model and reload the data later in case we want to use another specification.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load required packages for this tutorial</span>
<span class="nf">library</span><span class="p">(</span><span class="n">DoubleML</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">mlr3</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">mlr3learners</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>

<span class="c1"># suppress messages during fitting</span>
<span class="n">lgr</span><span class="o">::</span><span class="nf">get_logger</span><span class="p">(</span><span class="s">&quot;mlr3&quot;</span><span class="p">)</span><span class="o">$</span><span class="nf">set_threshold</span><span class="p">(</span><span class="s">&quot;warn&quot;</span><span class="p">)</span>

<span class="c1"># load data as a data.table</span>
<span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fetch_401k</span><span class="p">(</span><span class="n">return_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data.table&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">instrument</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Warning message:
&#34;Paket &#39;mlr3&#39; wurde unter R Version 4.2.3 erstellt&#34;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>9915</li><li>12</li></ol></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Classes &#39;data.table&#39; and &#39;data.frame&#39;:  9915 obs. of  12 variables:
 $ net_tfa: num  0 1015 -2000 15000 0 ...
 $ age    : num  47 36 37 58 32 34 28 54 43 32 ...
 $ inc    : num  6765 28452 3300 52590 21804 ...
 $ educ   : num  8 16 12 16 11 16 12 11 14 18 ...
 $ fsize  : num  2 1 6 2 1 1 3 3 2 3 ...
 $ marr   : num  0 0 0 1 0 0 1 0 1 1 ...
 $ twoearn: num  0 0 0 1 0 0 1 0 1 0 ...
 $ db     : num  0 0 1 0 0 0 0 0 1 0 ...
 $ pira   : num  0 0 0 0 0 1 1 0 1 0 ...
 $ hown   : num  1 1 0 1 1 1 1 1 1 1 ...
 $ p401   : int  0 0 0 0 0 0 0 0 0 0 ...
 $ e401   : int  0 0 0 0 0 0 0 0 0 0 ...
 - attr(*, &#34;.internal.selfref&#34;)=&lt;externalptr&gt;
</pre></div></div>
</div>
<p>See the “Details” section on the description of the data set, which can be accessed by typing <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">help(fetch_401k)</a>.</p>
<p>The data consist of 9,915 observations at the household level drawn from the 1991 Survey of Income and Program Participation (SIPP). All the variables are referred to 1990. We use net financial assets (<em>net_tfa</em>) as the outcome variable, <span class="math notranslate nohighlight">\(Y\)</span>, in our analysis. The net financial assets are computed as the sum of IRA balances, 401(k) balances, checking accounts, saving bonds, other interest-earning accounts, other interest-earning assets, stocks, and mutual funds less non mortgage debts.</p>
<p>Among the <span class="math notranslate nohighlight">\(9915\)</span> individuals, <span class="math notranslate nohighlight">\(3682\)</span> are eligible to participate in the program. The variable <em>e401</em> indicates eligibility and <em>p401</em> indicates participation, respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">hist_e401</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e401</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">e401</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="nf">geom_bar</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Eligibility, 401(k)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span>
<span class="w">                  </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">))</span>
<span class="n">hist_e401</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pension_7_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pension_7_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">hist_p401</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p401</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">p401</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="nf">geom_bar</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Participation, 401(k)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span>
<span class="w">                  </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">))</span>
<span class="n">hist_p401</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pension_8_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pension_8_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
<p>Eligibility is highly associated with financial wealth:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dens_net_tfa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">net_tfa</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">e401</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">e401</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">                    </span><span class="nf">geom_density</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">xlim</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">-20000</span><span class="p">,</span><span class="w"> </span><span class="m">150000</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">                    </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="n">.</span><span class="o">~</span><span class="n">e401</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">                    </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">))</span>

<span class="n">dens_net_tfa</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Warning message:
&#34;Removed 340 rows containing non-finite values (`stat_density()`).&#34;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pension_10_1.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pension_10_1.png" style="width: 420px; height: 420px;" />
</div>
</div>
<p>As a first estimate, we calculate the unconditional average predictive effect (APE) of 401(k) eligibility on accumulated assets. This effect corresponds to the average treatment effect if 401(k) eligibility would be assigned to individuals in an entirely randomized way. The unconditional APE of e401 is about <span class="math notranslate nohighlight">\(19559\)</span>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">APE_e401_uncond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">e401</span><span class="o">==</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">net_tfa</span><span class="p">)]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">e401</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">net_tfa</span><span class="p">)]</span>
<span class="nf">round</span><span class="p">(</span><span class="n">APE_e401_uncond</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
19559.34</div>
</div>
<p>Among the <span class="math notranslate nohighlight">\(3682\)</span> individuals that are eligible, <span class="math notranslate nohighlight">\(2594\)</span> decided to participate in the program. The unconditional APE of p401 is about <span class="math notranslate nohighlight">\(27372\)</span>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">APE_p401_uncond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">p401</span><span class="o">==</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">net_tfa</span><span class="p">)]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">p401</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">net_tfa</span><span class="p">)]</span>
<span class="nf">round</span><span class="p">(</span><span class="n">APE_p401_uncond</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
27371.58</div>
</div>
<p>As discussed, these estimates are biased since they do not account for saver heterogeneity and endogeneity of participation.</p>
</section>
<section id="The-DoubleML-package">
<h2>The <code class="docutils literal notranslate"><span class="pre">DoubleML</span></code> package<a class="headerlink" href="#The-DoubleML-package" title="Link to this heading">#</a></h2>
<p>Let’s use the package <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> to estimate the average treatment effect of 401(k) eligibility, i.e. <code class="docutils literal notranslate"><span class="pre">e401</span></code>, and participation, i.e. <code class="docutils literal notranslate"><span class="pre">p401</span></code>, on net financial assets <code class="docutils literal notranslate"><span class="pre">net_tfa</span></code>.</p>
</section>
<section id="Estimating-the-Average-Treatment-Effect-of-401(k)-Eligibility-on-Net-Financial-Assets">
<h2>Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets<a class="headerlink" href="#Estimating-the-Average-Treatment-Effect-of-401(k)-Eligibility-on-Net-Financial-Assets" title="Link to this heading">#</a></h2>
<p>We first look at the treatment effect of <code class="docutils literal notranslate"><span class="pre">e401</span></code> on net total financial assets. We give estimates of the ATE in the linear model</p>
<p><span class="math">\begin{equation*}
Y = D \alpha + f(X)'\beta+ \epsilon,
\end{equation*}</span> where <span class="math notranslate nohighlight">\(f(X)\)</span> is a dictonary applied to the raw regressors. <span class="math notranslate nohighlight">\(X\)</span> contains variables on marital status, two-earner status, defined benefit pension status, IRA participation, home ownership, family size, education, age, and income.</p>
<p>In the following, we will consider two different models,</p>
<ul class="simple">
<li><p>a basic model specification that includes the raw regressors, i.e., <span class="math notranslate nohighlight">\(f(X) = X\)</span>, and</p></li>
<li><p>a flexible model specification, where <span class="math notranslate nohighlight">\(f(X)\)</span> includes the raw regressors <span class="math notranslate nohighlight">\(X\)</span> and the orthogonal polynomials of degree 2 for the variables family size education, age, and income.</p></li>
</ul>
<p>We will use the basic model specification whenever we use nonlinear methods, for example regression trees or random forests, and use the flexible model for linear methods such as the lasso. There are, of course, multiple ways how the model can be specified even more flexibly, for example including interactions of variable and higher order interaction. However, for the sake of simplicity we stick to the specification above. Users who are interested in varying the model can manipulate the model
formula below (<code class="docutils literal notranslate"><span class="pre">formula_flex</span></code>), for example implementing the orignal specification in <a class="reference external" href="https://arxiv.org/abs/1608.00060">Chernozhukov et al. (2018)</a>.</p>
<p>In the first step, we report estimates of the average treatment effect (ATE) of 401(k) eligibility on net financial assets both in the partially linear regression (PLR) model and in the interactive regression model (IRM) allowing for heterogeneous treatment effects.</p>
<section id="The-Data-Backend:-DoubleMLData">
<h3>The Data Backend: <code class="docutils literal notranslate"><span class="pre">DoubleMLData</span></code><a class="headerlink" href="#The-Data-Backend:-DoubleMLData" title="Link to this heading">#</a></h3>
<p>To start our analysis, we initialize the data backend, i.e., a new instance of a <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/DoubleMLData.html">DoubleMLData</a> object. Here, we manually implement the regression model by using R’s formula interface. A shortcut would be to directly specify the options <code class="docutils literal notranslate"><span class="pre">polynomial_features</span></code> and <code class="docutils literal notranslate"><span class="pre">instrument</span></code> when calling <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">fetch_401k()</a>.<span class="math notranslate nohighlight">\(^{**}\)</span></p>
<p>To implement both models (basic and flexible), we generate two data backends: <code class="docutils literal notranslate"><span class="pre">data_dml_base</span></code> and <code class="docutils literal notranslate"><span class="pre">data_dml_flex</span></code>.</p>
<p><span class="math notranslate nohighlight">\(^{**}\)</span> Note that the model specification using <code class="docutils literal notranslate"><span class="pre">polynomial_features</span></code> differs from the one used in our example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up basic model: Specify variables for data-backend</span>
<span class="n">features_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;inc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;educ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fsize&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="s">&quot;marr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;twoearn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;db&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pira&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hown&quot;</span><span class="p">)</span>

<span class="c1"># Initialize DoubleMLData (data-backend of DoubleML)</span>
<span class="n">data_dml_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLData</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">y_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;net_tfa&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">d_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">x_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">features_base</span><span class="p">)</span>
<span class="n">data_dml_base</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): e401
Covariates: age, inc, educ, fsize, marr, twoearn, db, pira, hown
Instrument(s):
No. Observations: 9915
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a model according to regression formula with polynomials</span>
<span class="n">formula_flex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">formula</span><span class="p">(</span><span class="s">&quot; ~ -1 + poly(age, 2, raw=TRUE) +</span>
<span class="s">                        poly(inc, 2, raw=TRUE) + poly(educ, 2, raw=TRUE) +</span>
<span class="s">                        poly(fsize, 2, raw=TRUE) + marr + twoearn +</span>
<span class="s">                        db + pira + hown&quot;</span><span class="p">)</span>
<span class="n">features_flex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="nf">model.matrix</span><span class="p">(</span><span class="n">formula_flex</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>

<span class="n">model_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="s">&quot;net_tfa&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="n">net_tfa</span><span class="p">],</span>
<span class="w">                        </span><span class="s">&quot;e401&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="n">e401</span><span class="p">],</span>
<span class="w">                        </span><span class="n">features_flex</span><span class="p">)</span>

<span class="c1"># Initialize DoubleMLData (data-backend of DoubleML)</span>
<span class="n">data_dml_flex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLData</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">model_data</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">y_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;net_tfa&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">d_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">)</span>

<span class="n">data_dml_flex</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): e401
Covariates: poly.age..2..raw...TRUE.1, poly.age..2..raw...TRUE.2, poly.inc..2..raw...TRUE.1, poly.inc..2..raw...TRUE.2, poly.educ..2..raw...TRUE.1, poly.educ..2..raw...TRUE.2, poly.fsize..2..raw...TRUE.1, poly.fsize..2..raw...TRUE.2, marr, twoearn, db, pira, hown
Instrument(s):
No. Observations: 9915
</pre></div></div>
</div>
</section>
<section id="Partially-Linear-Regression-Model-(PLR)">
<h3>Partially Linear Regression Model (PLR)<a class="headerlink" href="#Partially-Linear-Regression-Model-(PLR)" title="Link to this heading">#</a></h3>
<p>We start using lasso to estimate the function <span class="math notranslate nohighlight">\(g_0\)</span> and <span class="math notranslate nohighlight">\(m_0\)</span> in the following PLR model:</p>
<p><span class="math">\begin{eqnarray}
& Y = D\theta_0 + g_0(X) + \zeta, &\quad E[\zeta \mid D,X]= 0,\\
& D = m_0(X) +  V, &\quad E[V \mid X] = 0.
\end{eqnarray}</span></p>
<p>To estimate the causal parameter <span class="math notranslate nohighlight">\(\theta_0\)</span> here, we use double machine learning with 3-fold cross-fitting.</p>
<p>Estimation of the nuisance components <span class="math notranslate nohighlight">\(g_0\)</span> and <span class="math notranslate nohighlight">\(m_0\)</span>, is based on the lasso with cross-validated choice of the penalty term , <span class="math notranslate nohighlight">\(\lambda\)</span>, as provided by the <a class="reference external" href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet package</a>. We load the learner by using the <a class="reference external" href="https://mlr3.mlr-org.com/">mlr3</a> function <a class="reference external" href="https://mlr3.mlr-org.com/reference/Learner.html">lrn()</a>. Hyperparameters and options can be set during instantiation of the learner. Here we specify that the lasso
should use that value of <span class="math notranslate nohighlight">\(\lambda\)</span> that minimizes the cross-validated mean squared error which is based on 5-fold cross validation.</p>
<p>In order to use a learner, the underlying R packages have to be installed. In this case, the package <a class="reference external" href="https://glmnet.stanford.edu/reference/cv.glmnet.html">glmnet package</a> needs to be installed. Moreover, installation of the package <a class="reference external" href="https://mlr3learners.mlr-org.com/">mlr3learners</a> is required.</p>
<p>We start by estimation the ATE in the basic model and then repeat the estimation in the flexible model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize learners</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.cv_glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nfolds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lambda.min&quot;</span><span class="p">)</span>
<span class="n">lasso_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.cv_glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nfolds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lambda.min&quot;</span><span class="p">)</span>

<span class="c1"># Initialize DoubleMLPLR model</span>
<span class="n">dml_plr_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso_class</span><span class="p">,</span>
<span class="w">                                </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">dml_plr_lasso</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_plr_lasso</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      6133       1465   4.185 2.85e-05 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize learners</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.cv_glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nfolds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lambda.min&quot;</span><span class="p">)</span>
<span class="n">lasso_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.cv_glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nfolds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lambda.min&quot;</span><span class="p">)</span>

<span class="c1"># Initialize DoubleMLPLR model</span>
<span class="n">dml_plr_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_flex</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso_class</span><span class="p">,</span>
<span class="w">                                </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">dml_plr_lasso</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_plr_lasso</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      9580       1325   7.229 4.87e-13 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<p>Alternatively, we can repeat this procedure with other machine learning methods, for example a random forest learner as provided by the <a class="reference external" href="https://github.com/imbs-hl/ranger">ranger</a> package for R. The website of the <a class="reference external" href="https://mlr3extralearners.mlr-org.com/articles/learners/list_learners.html">mlr3extralearners</a> package has a searchable list of all learners that are available in the <a class="reference external" href="https://mlr3verse.mlr-org.com/">mlr3verse</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random Forest</span>
<span class="n">randomForest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.ranger&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span>
<span class="w">                   </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">randomForest_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.ranger&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span>
<span class="w">                         </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_plr_forest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">ml_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomForest</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomForest_class</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">dml_plr_forest</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_plr_forest</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      9127       1313   6.952 3.61e-12 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<p>Now, let’s use a regression tree as provided by the R package <a class="reference external" href="https://github.com/bethatkinson/rpart">rpart</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trees</span>
<span class="n">trees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.rpart&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0047</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">203</span><span class="p">)</span>
<span class="n">trees_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0042</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">104</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_plr_tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
<span class="w">                               </span><span class="n">ml_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees</span><span class="p">,</span>
<span class="w">                               </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_class</span><span class="p">,</span>
<span class="w">                               </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">dml_plr_tree</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_plr_tree</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      8210       1324   6.203 5.55e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<p>We can also experiment with extreme gradient boosting as provided by <a class="reference external" href="https://xgboost.readthedocs.io/en/latest/">xgboost</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boosted trees</span>
<span class="n">boost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.xgboost&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;reg:squarederror&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">35</span><span class="p">)</span>
<span class="n">boost_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.xgboost&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binary:logistic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">eval_metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;logloss&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">34</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_plr_boost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost_class</span><span class="p">,</span>
<span class="w">                                </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">dml_plr_boost</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_plr_boost</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      8700       1360   6.399 1.57e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<p>Let’s sum up the results:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">confints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rbind</span><span class="p">(</span><span class="n">dml_plr_lasso</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span><span class="w"> </span><span class="n">dml_plr_forest</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span>
<span class="w">                 </span><span class="n">dml_plr_tree</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span><span class="w"> </span><span class="n">dml_plr_boost</span><span class="o">$</span><span class="nf">confint</span><span class="p">())</span>
<span class="n">estimates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">dml_plr_lasso</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">dml_plr_forest</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span>
<span class="w">              </span><span class="n">dml_plr_tree</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">dml_plr_boost</span><span class="o">$</span><span class="n">coef</span><span class="p">)</span>
<span class="n">result_plr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PLR&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;ML&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ranger&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rpart&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xgboost&quot;</span><span class="p">),</span>
<span class="w">                        </span><span class="s">&quot;Estimate&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">estimates</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;lower&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confints</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span>
<span class="w">                        </span><span class="s">&quot;upper&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confints</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span>
<span class="n">result_plr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table class="dataframe">
<caption>A data.table: 4 × 5</caption>
<thead>
    <tr><th scope=col>model</th><th scope=col>ML</th><th scope=col>Estimate</th><th scope=col>lower</th><th scope=col>upper</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>PLR</td><td>glmnet </td><td>9579.771</td><td>6982.443</td><td>12177.10</td></tr>
    <tr><td>PLR</td><td>ranger </td><td>9126.999</td><td>6553.684</td><td>11700.31</td></tr>
    <tr><td>PLR</td><td>rpart  </td><td>8209.737</td><td>5615.525</td><td>10803.95</td></tr>
    <tr><td>PLR</td><td>xgboost</td><td>8700.134</td><td>6035.281</td><td>11364.99</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">g_ci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">result_plr</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Estimate</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_errorbar</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w">  </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;Coefficients and 0.95- confidence interval&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">xlab</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">),</span><span class="w"> </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">))</span>

<span class="n">g_ci</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pension_38_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pension_38_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
</section>
<section id="Interactive-Regression-Model-(IRM)">
<h3>Interactive Regression Model (IRM)<a class="headerlink" href="#Interactive-Regression-Model-(IRM)" title="Link to this heading">#</a></h3>
<p>Next, we consider estimation of average treatment effects when treatment effects are fully heterogeneous:</p>
<p><span class="math">\begin{eqnarray}
& Y = g_0(D,X) + U, &\quad E[U\mid X,D] = 0,\\
& D = m_0(X) + V, &\quad E[V\mid X] = 0.
\end{eqnarray}</span></p>
<p>To reduce the disproportionate impact of extreme propensity score weights in the interactive model we trim the propensity scores which are close to the bounds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="c1"># Initialize DoubleMLIRM model</span>
<span class="n">dml_irm_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIRM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_flex</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso_class</span><span class="p">,</span>
<span class="w">                                </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                                </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
<span class="n">dml_irm_lasso</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_irm_lasso</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      8850       1341   6.601 4.08e-11 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize Learner</span>
<span class="n">randomForest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.ranger&quot;</span><span class="p">)</span>
<span class="n">randomForest_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.ranger&quot;</span><span class="p">)</span>

<span class="c1"># Random Forest</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_irm_forest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIRM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomForest</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomForest_class</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_irm_forest</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">))</span>
<span class="n">dml_irm_forest</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">))</span>
<span class="n">dml_irm_forest</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">))</span>

<span class="n">dml_irm_forest</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_irm_forest</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      8202       1118   7.334 2.23e-13 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize Learner</span>
<span class="n">trees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.rpart&quot;</span><span class="p">)</span>
<span class="n">trees_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">)</span>

<span class="c1"># Trees</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_irm_tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIRM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
<span class="w">                          </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees</span><span class="p">,</span>
<span class="w">                          </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_class</span><span class="p">,</span>
<span class="w">                          </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                          </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_irm_tree</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0016</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">74</span><span class="p">))</span>
<span class="n">dml_irm_tree</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0018</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">70</span><span class="p">))</span>
<span class="n">dml_irm_tree</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0028</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">167</span><span class="p">))</span>

<span class="n">dml_irm_tree</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_irm_tree</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      8415       1186   7.098 1.26e-12 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize Learners</span>
<span class="n">boost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.xgboost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;reg:squarederror&quot;</span><span class="p">)</span>
<span class="n">boost_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.xgboost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binary:logistic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">eval_metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;logloss&quot;</span><span class="p">)</span>

<span class="c1"># Boosted Trees</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_irm_boost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIRM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost</span><span class="p">,</span>
<span class="w">                                </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost_class</span><span class="p">,</span>
<span class="w">                                </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                                </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nf">compareVersion</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="nf">packageVersion</span><span class="p">(</span><span class="s">&quot;DoubleML&quot;</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;0.2.1&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">29</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">23</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span>
<span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># behavior of set_ml_nuisance_params() changed in https://github.com/DoubleML/doubleml-for-r/pull/89</span>
<span class="w">    </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;reg:squarederror&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">29</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;reg:squarederror&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">23</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binary:logistic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">eval_metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;logloss&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
e401      8048       1182   6.808 9.91e-12 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">confints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rbind</span><span class="p">(</span><span class="n">dml_irm_lasso</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span><span class="w"> </span><span class="n">dml_irm_forest</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span>
<span class="w">                 </span><span class="n">dml_irm_tree</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span><span class="w"> </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="nf">confint</span><span class="p">())</span>
<span class="n">estimates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">dml_irm_lasso</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">dml_irm_forest</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span>
<span class="w">              </span><span class="n">dml_irm_tree</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">dml_irm_boost</span><span class="o">$</span><span class="n">coef</span><span class="p">)</span>
<span class="n">result_irm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;IRM&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;ML&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ranger&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rpart&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xgboost&quot;</span><span class="p">),</span>
<span class="w">                        </span><span class="s">&quot;Estimate&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">estimates</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;lower&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confints</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span>
<span class="w">                        </span><span class="s">&quot;upper&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confints</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span>
<span class="n">result_irm</span>

<span class="n">g_ci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">result_irm</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Estimate</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_errorbar</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w">  </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;Coefficients and 0.95- confidence interval&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">xlab</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">),</span><span class="w"> </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">))</span>

<span class="n">g_ci</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table class="dataframe">
<caption>A data.table: 4 × 5</caption>
<thead>
    <tr><th scope=col>model</th><th scope=col>ML</th><th scope=col>Estimate</th><th scope=col>lower</th><th scope=col>upper</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>IRM</td><td>glmnet </td><td>8850.064</td><td>6222.396</td><td>11477.73</td></tr>
    <tr><td>IRM</td><td>ranger </td><td>8202.101</td><td>6010.245</td><td>10393.96</td></tr>
    <tr><td>IRM</td><td>rpart  </td><td>8415.276</td><td>6091.618</td><td>10738.93</td></tr>
    <tr><td>IRM</td><td>xgboost</td><td>8047.598</td><td>5730.684</td><td>10364.51</td></tr>
</tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pension_47_1.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pension_47_1.png" style="width: 420px; height: 420px;" />
</div>
</div>
<p>These estimates that flexibly account for confounding are substantially attenuated relative to the baseline estimate (<em>19559</em>) that does not account for confounding. They suggest much smaller causal effects of 401(k) eligiblity on financial asset holdings.</p>
</section>
</section>
<section id="Local-Average-Treatment-Effects-of-401(k)-Participation-on-Net-Financial-Assets">
<h2>Local Average Treatment Effects of 401(k) Participation on Net Financial Assets<a class="headerlink" href="#Local-Average-Treatment-Effects-of-401(k)-Participation-on-Net-Financial-Assets" title="Link to this heading">#</a></h2>
<section id="Interactive-IV-Model-(IIVM)">
<h3>Interactive IV Model (IIVM)<a class="headerlink" href="#Interactive-IV-Model-(IIVM)" title="Link to this heading">#</a></h3>
<p>In the examples above, we estimated the average treatment effect of <em>eligibility</em> on financial asset holdings. Now, we consider estimation of local average treatment effects (LATE) of <em>participation</em> using eligibility as an instrument for the participation decision. Under appropriate assumptions, the LATE identifies the treatment effect for so-called compliers, i.e., individuals who would only participate if eligible and otherwise not participate in the program.</p>
<p>As before, <span class="math notranslate nohighlight">\(Y\)</span> denotes the outcome <code class="docutils literal notranslate"><span class="pre">net_tfa</span></code>, and <span class="math notranslate nohighlight">\(X\)</span> is the vector of covariates. We use <code class="docutils literal notranslate"><span class="pre">e401</span></code> as a binary instrument for the treatment variable <code class="docutils literal notranslate"><span class="pre">p401</span></code>. Here the structural equation model is:</p>
<p><span class="math">\begin{eqnarray}
& Y = g_0(Z,X) + U, &\quad E[U\mid Z,X] = 0,\\
& D = r_0(Z,X) + V, &\quad E[V\mid Z, X] = 0,\\
& Z = m_0(X) + \zeta, &\quad E[\zeta \mid X] = 0.
\end{eqnarray}</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize DoubleMLData with an instrument</span>

<span class="c1"># Basic model</span>
<span class="n">data_dml_base_iv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLData</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">y_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;net_tfa&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">d_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">x_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">features_base</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">z_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">)</span>
<span class="n">data_dml_base_iv</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): p401
Covariates: age, inc, educ, fsize, marr, twoearn, db, pira, hown
Instrument(s): e401
No. Observations: 9915
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flexible model</span>
<span class="n">model_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="s">&quot;net_tfa&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="n">net_tfa</span><span class="p">],</span>
<span class="w">                        </span><span class="s">&quot;e401&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="n">e401</span><span class="p">],</span>
<span class="w">                        </span><span class="s">&quot;p401&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="n">p401</span><span class="p">],</span>
<span class="w">                        </span><span class="n">features_flex</span><span class="p">)</span>
<span class="n">data_dml_flex_iv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLData</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">model_data</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">y_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;net_tfa&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">d_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">z_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;e401&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_iivm_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIIVM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_flex_iv</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso_class</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">ml_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lasso_class</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">subgroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">always_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">                                                   </span><span class="n">never_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
<span class="n">dml_iivm_lasso</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_iivm_lasso</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
p401     12802       1941   6.597  4.2e-11 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<p>Again, we repeat the procedure for the other machine learning methods:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize Learner</span>
<span class="n">randomForest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.ranger&quot;</span><span class="p">)</span>
<span class="n">randomForest_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.ranger&quot;</span><span class="p">)</span>

<span class="c1"># Random Forest</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_iivm_forest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIIVM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base_iv</span><span class="p">,</span>
<span class="w">                              </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomForest</span><span class="p">,</span>
<span class="w">                              </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomForest_class</span><span class="p">,</span>
<span class="w">                              </span><span class="n">ml_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomForest_class</span><span class="p">,</span>
<span class="w">                              </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span>
<span class="w">                              </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                              </span><span class="n">subgroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">always_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">never_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_iivm_forest</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">))</span>
<span class="n">dml_iivm_forest</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">))</span>
<span class="n">dml_iivm_forest</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">))</span>
<span class="n">dml_iivm_forest</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_r1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">max.depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">))</span>

<span class="n">dml_iivm_forest</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_iivm_forest</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
p401     11792       1604   7.352 1.95e-13 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize Learner</span>
<span class="n">trees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.rpart&quot;</span><span class="p">)</span>
<span class="n">trees_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">)</span>

<span class="c1"># Trees</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_iivm_tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIIVM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base_iv</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_class</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">ml_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_class</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">subgroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">always_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">                                                  </span><span class="n">never_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_iivm_tree</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0016</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">74</span><span class="p">))</span>
<span class="n">dml_iivm_tree</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0018</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">70</span><span class="p">))</span>
<span class="n">dml_iivm_tree</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0028</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">167</span><span class="p">))</span>
<span class="n">dml_iivm_tree</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ml_r1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.0576</span><span class="p">,</span><span class="w"> </span><span class="n">minsplit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">55</span><span class="p">))</span>

<span class="n">dml_iivm_tree</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_iivm_tree</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
p401     12214       1714   7.128 1.02e-12 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize Learner</span>
<span class="n">boost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.xgboost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;reg:squarederror&quot;</span><span class="p">)</span>
<span class="n">boost_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.xgboost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binary:logistic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">eval_metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;logloss&quot;</span><span class="p">)</span>

<span class="c1"># Boosted Trees</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dml_iivm_boost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLIIVM</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">data_dml_base_iv</span><span class="p">,</span>
<span class="w">                              </span><span class="n">ml_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost</span><span class="p">,</span>
<span class="w">                              </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost_class</span><span class="p">,</span>
<span class="w">                              </span><span class="n">ml_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost_class</span><span class="p">,</span>
<span class="w">                              </span><span class="n">n_folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span>
<span class="w">                              </span><span class="n">trimming_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w">                              </span><span class="n">subgroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">always_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">never_takers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nf">compareVersion</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="nf">packageVersion</span><span class="p">(</span><span class="s">&quot;DoubleML&quot;</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;0.2.1&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">33</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_r1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span>
<span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># behavior of set_ml_nuisance_params() changed in https://github.com/DoubleML/doubleml-for-r/pull/89</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;reg:squarederror&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_g1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">33</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;reg:squarederror&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binary:logistic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">eval_metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;logloss&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">set_ml_nuisance_params</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;ml_r1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;p401&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">list</span><span class="p">(</span><span class="n">nrounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binary:logistic&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">eval_metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;logloss&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimates and significance testing of the effect of target variables
     Estimate. Std. Error t value Pr(&gt;|t|)
p401     11861       1619   7.324  2.4e-13 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">confints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rbind</span><span class="p">(</span><span class="n">dml_iivm_lasso</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span><span class="w"> </span><span class="n">dml_iivm_forest</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span>
<span class="w">                 </span><span class="n">dml_iivm_tree</span><span class="o">$</span><span class="nf">confint</span><span class="p">(),</span><span class="w"> </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="nf">confint</span><span class="p">())</span>
<span class="n">estimates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">dml_iivm_lasso</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">dml_iivm_forest</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span>
<span class="w">              </span><span class="n">dml_iivm_tree</span><span class="o">$</span><span class="n">coef</span><span class="p">,</span><span class="w"> </span><span class="n">dml_iivm_boost</span><span class="o">$</span><span class="n">coef</span><span class="p">)</span>
<span class="n">result_iivm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;IIVM&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;ML&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ranger&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rpart&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xgboost&quot;</span><span class="p">),</span>
<span class="w">                        </span><span class="s">&quot;Estimate&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">estimates</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;lower&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confints</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span>
<span class="w">                        </span><span class="s">&quot;upper&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confints</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span>
<span class="n">result_iivm</span>

<span class="n">g_ci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">result_iivm</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Estimate</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_errorbar</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w">  </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;Coefficients and 0.95- confidence interval&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">xlab</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">),</span><span class="w"> </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">))</span>

<span class="n">g_ci</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table class="dataframe">
<caption>A data.table: 4 × 5</caption>
<thead>
    <tr><th scope=col>model</th><th scope=col>ML</th><th scope=col>Estimate</th><th scope=col>lower</th><th scope=col>upper</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>IIVM</td><td>glmnet </td><td>12802.26</td><td>8998.639</td><td>16605.88</td></tr>
    <tr><td>IIVM</td><td>ranger </td><td>11792.22</td><td>8648.579</td><td>14935.87</td></tr>
    <tr><td>IIVM</td><td>rpart  </td><td>12214.45</td><td>8855.864</td><td>15573.04</td></tr>
    <tr><td>IIVM</td><td>xgboost</td><td>11861.19</td><td>8687.158</td><td>15035.22</td></tr>
</tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pension_59_1.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pension_59_1.png" style="width: 420px; height: 420px;" />
</div>
</div>
</section>
</section>
<section id="Summary-of-Results">
<h2>Summary of Results<a class="headerlink" href="#Summary-of-Results" title="Link to this heading">#</a></h2>
<p>To sum up, let’s merge all our results so far and illustrate them in a plot.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">summary_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rbindlist</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">result_plr</span><span class="p">,</span><span class="w"> </span><span class="n">result_irm</span><span class="p">,</span><span class="w"> </span><span class="n">result_iivm</span><span class="p">))</span>
<span class="n">summary_result</span><span class="p">[,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;PLR&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;IRM&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;IIVM&quot;</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">g_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">summary_result</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Estimate</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_errorbar</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ML</span><span class="p">))</span><span class="w">  </span><span class="o">+</span>
<span class="w">        </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grey&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;Coefficients and 0.95- confidence interval&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">xlab</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">),</span><span class="w"> </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;none&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>

<span class="n">g_all</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pension_63_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pension_63_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
<p>We report results based on four ML methods for estimating the nuisance functions used in forming the orthogonal estimating equations. We find again that the estimates of the treatment effect are stable across ML methods. The estimates are highly significant, hence we would reject the hypothesis that 401(k) participation has no effect on financial wealth.</p>
<hr class="docutils" />
<p><strong>Acknowledgement</strong></p>
<p>We would like to thank <a class="reference external" href="https://www.dice.hhu.de/en/dice/people/professors-1/kueck">Jannis Kueck</a> for sharing <a class="reference external" href="https://www.kaggle.com/janniskueck/pm5-401k">the kaggle notebook</a>. The pension data set has been analyzed in several studies, among others <a class="reference external" href="https://arxiv.org/abs/1608.00060">Chernozhukov et al. (2018)</a>.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="R_double_ml_basics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">R: Basics of Double Machine Learning</p>
      </div>
    </a>
    <a class="right-next"
       href="R_double_ml_did.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">R: DoubleML for Difference-in-Differences</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Data">Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#The-DoubleML-package">The <code class="docutils literal notranslate"><span class="pre">DoubleML</span></code> package</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Estimating-the-Average-Treatment-Effect-of-401(k)-Eligibility-on-Net-Financial-Assets">Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#The-Data-Backend:-DoubleMLData">The Data Backend: <code class="docutils literal notranslate"><span class="pre">DoubleMLData</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Partially-Linear-Regression-Model-(PLR)">Partially Linear Regression Model (PLR)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Interactive-Regression-Model-(IRM)">Interactive Regression Model (IRM)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Local-Average-Treatment-Effects-of-401(k)-Participation-on-Net-Financial-Assets">Local Average Treatment Effects of 401(k) Participation on Net Financial Assets</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Interactive-IV-Model-(IIVM)">Interactive IV Model (IIVM)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Summary-of-Results">Summary of Results</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/DoubleML/doubleml-docs/edit/dev/doc/examples/R_double_ml_pension.ipynb">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/examples/R_double_ml_pension.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023, Bach, P., Chernozhukov, V., Klaassen, S., Kurz, M. S., and Spindler, M..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>