
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DoubleML Workflow &#8212; DoubleML  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    <link rel="shortcut icon" href="../_static/../img/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API reference" href="../api/api.html" />
    <link rel="prev" title="9. Sample-splitting, cross-fitting and repeated cross-fitting" href="../guide/resampling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">DoubleML</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  DoubleML
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../intro/install.html">
  Install
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../intro/intro.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../guide/guide.html">
  User guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Workflow
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api.html">
  Python API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://docs.doubleml.org/r/stable/">
  R API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples/index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../release/release.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/DoubleML/doubleml-for-py" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><p class="logo" style="text-align:center;"><a href="../index.html">
    <img class="logo" src="../logo.png" alt="Logo" width="65%" height="65%">
</a></p><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav><style>

.toc-entry {
  list-style: none;
  margin-left: 0em;
  min-height: 50px;
  border-left: 2px solid rgba(var(--pst-color-text-base), 1);
  padding: 0 0 50px 0px;
  position: relative;
}
.toc-entry:last-child{
  border-left: 0;
  left: 2px;
}

.toc-entry::after{
  border-left: 0;
  position: absolute;
  left: -8px;
  top: 0px;
  content: " ";
  border: 2px solid rgba(255, 255, 255, 1);
  border-radius: 500%;
  background: rgba(var(--pst-color-toc-link-active), 1);
  height: 15px;
  width: 15px;
}

.toc-entry:hover::after {
  background: rgba(var(--pst-color-link-hover), 1);
  transition: all 200ms ease-in-out;
}

.toc-entry > .nav-link {
  position: relative;
  font-size: small;
  font-weight: 600;
  text-align: left;
  margin: 0;
  top: -5px;
  color: rgba(var(--pst-color-text-base), 1);
}

.toc-entry > .nav-link.active {
  color: rgba(255, 255, 255, 1);
  font-size: medium;
  background-color: rgba(var(--pst-color-toc-link-active), 1);
  border-bottom-right-radius: 20px;
  border-top-right-radius: 20px;
  border-left: 0;
  margin-left: 2px;
  padding-right: 15px;
  top: -7px;
  transition: background-color 200ms ease-in-out, color 200ms ease-in-out, border 200ms ease-in-out, font-size 200ms ease-in-out;
}

</style>

            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-formulation">
   0. Problem Formulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-backend">
   1. Data-Backend
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#causal-model">
   2. Causal Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ml-methods">
   3. ML Methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dml-specifications">
   4. DML Specifications
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimation">
   5. Estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inference">
   6. Inference
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="doubleml-workflow">
<h1>DoubleML Workflow<a class="headerlink" href="#doubleml-workflow" title="Permalink to this headline">Â¶</a></h1>
<p>The following steps, which we call the DoubleML workflow, are intended to provide a rough structure for causal analyses
with <a class="reference internal" href="../index.html#doubleml-package"><span class="std std-ref">DoubleML</span></a>. After a short explanation of the idea of each step, we illustrate their meaning in the 401(k)
example. In case you are interested in more details of the 401(k) example, you can visit the
<a class="reference external" href="https://docs.doubleml.org/stable/examples/py_double_ml_pension.html">Python</a> and <a class="reference external" href="https://docs.doubleml.org/stable/examples/R_double_ml_pension.html">R</a>
Notebooks that are available online.</p>
<div class="section" id="problem-formulation">
<h2>0. Problem Formulation<a class="headerlink" href="#problem-formulation" title="Permalink to this headline">Â¶</a></h2>
<p>The initial step of the DoubleML workflow is to formulate the causal problem at hand. Before we start our statistical
analysis, we have to explicitly state the conditions required for a causal interpretation of the estimator, which will
be computed later. In many cases, directed acyclical graphs (DAGs) are helpful to formulate the causal problem,
illustrate the involved causal channels and the critical parts of the inferential framework. At this stage, a precise
argumentation and discussion of the research question is crucial.</p>
<a class="reference internal image-reference" href="../_images/causal_graph.svg"><img alt="DAG for the 401(k) Example" class="align-center" src="../_images/causal_graph.svg" width="800" /></a>
<p>In the 401(k) study, we are interested in estimating the average treatment effect of participation in so-called 401(k) pension
plans on employeesâ net financial assets. Because we cannot rely on a properly conducted randomized control study in this
example, we have to base our analysis on observational data. Hence, we have to use an identification strategy that is based
on appropriately controlling for potential confounders.
A complication that arises in the 401(k) example is due to so-called endogeneity of the treatment assignment. The treatment
variable is an employeeâs participation in a 401(k) pension plan which is a decision made by employees and likely
to be affected by unobservable effects. For example, is seems reasonable that persons with higher income have stronger
preferences to save and also to participate in a pension plan. If our analysis does not account for this self-selection into
treatment, the estimated effect is likely to be biased.</p>
<p>To circumvent the endogenous treatment problem, it is possible to exploit randomness in eligibility for 401(k) plans.
In other words, the access to the treatment can be considered as randomly assigned once we control for confounding variables.
Earlier studies in this context argue that if characteristics that are related to saving preferences are taken into account,
eligibility can be considered as good as randomly assigned (at the time 401(k) plans were introduced).
The conditional exogeneity in the access to treatment makes it possible to estimate the causal effect of interest by using
an instrumental variable (IV) approach. However, for the sake of brevity, we will focus on the so-called intent-to-treat effect in the following.
This effect corresponds to the average treatment effect of eligibility (= the instrument) on net financial assets (= the outcome) and
is of great interest in many applications. The IV analysis is available in the <a class="reference external" href="https://docs.doubleml.org/stable/examples/py_double_ml_pension.html">Python</a>
and <a class="reference external" href="https://docs.doubleml.org/stable/examples/R_double_ml_pension.html">R</a> Notebooks that are available online.</p>
<p>The previous discussion focuses on the causal problem. Letâs also talk about the statistical methods used for estimation.
For identification of the average treatment effect of participation or eligibility on assets, it is crucial that we appropriately
account for the confounding factors. Thatâs where the machine learning tools come into play. Of course, we could simply estimate
the causal effect by using a classical linear (IV) regression model: The researcher has to manually pick and, perhaps,
transform the confounding variables in the regression model.
However, machine learning techniques offer greater flexibility in terms of a more data-driven specification
of the main regression equation and the first stage.</p>
</div>
<div class="section" id="data-backend">
<h2>1. Data-Backend<a class="headerlink" href="#data-backend" title="Permalink to this headline">Â¶</a></h2>
<p>In step 1., we initialize the data-backend and thereby declare the role of the outcome, the treatment, and the confounding variables.</p>
<p>We use data from the 1991 Survey of Income and Program Participation which is available via the function
<a class="reference external" href="https://docs.doubleml.org/stable/api/generated/doubleml.datasets.fetch_401K.html">fetch_401K (Python)</a>
or <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">fetch_401k (R)</a>.
The data-backend can be initialized from various data frame objects in Python and R. To estimate the intent-to-treat effect in the
401(k) example, we use eligibility (<code class="docutils literal notranslate"><span class="pre">e401</span></code>) as the treatment variable of interest. The outcome variable is <code class="docutils literal notranslate"><span class="pre">net_tfa</span></code> and we
control for confounding variables <code class="docutils literal notranslate"><span class="pre">['age',</span> <span class="pre">'inc',</span> <span class="pre">'educ',</span> <span class="pre">'fsize',</span> <span class="pre">'marr',</span> <span class="pre">'twoearn',</span> <span class="pre">'db',</span> <span class="pre">'pira',</span> <span class="pre">'hown']</span></code>.</p>
<div class="tabbed-set docutils">
<input checked="checked" id="1f672855-f24a-4062-b8b3-38d14cda11a9" name="a0e50702-b3da-4ff2-a1fc-b922e3fc3f78" type="radio">
</input><label class="tabbed-label" for="1f672855-f24a-4062-b8b3-38d14cda11a9">
Python</label><div class="tabbed-content docutils">
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">doubleml</span> <span class="kn">import</span> <span class="n">DoubleMLData</span>

<span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">doubleml.datasets</span> <span class="kn">import</span> <span class="n">fetch_401K</span>

<span class="gp">In [3]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">fetch_401K</span><span class="p">(</span><span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;DataFrame&#39;</span><span class="p">)</span>

<span class="go"># Construct DoubleMLData object</span>
<span class="gp">In [4]: </span><span class="n">dml_data</span> <span class="o">=</span> <span class="n">DoubleMLData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y_col</span><span class="o">=</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span> <span class="n">d_cols</span><span class="o">=</span><span class="s1">&#39;e401&#39;</span><span class="p">,</span>
<span class="gp">   ...: </span>                        <span class="n">x_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">,</span> <span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;fsize&#39;</span><span class="p">,</span> <span class="s1">&#39;marr&#39;</span><span class="p">,</span>
<span class="gp">   ...: </span>                                <span class="s1">&#39;twoearn&#39;</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;pira&#39;</span><span class="p">,</span> <span class="s1">&#39;hown&#39;</span><span class="p">])</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
</div>
<input id="a6a88ac2-abb2-41fd-827f-864ee2c4998d" name="a0e50702-b3da-4ff2-a1fc-b922e3fc3f78" type="radio">
</input><label class="tabbed-label" for="a6a88ac2-abb2-41fd-827f-864ee2c4998d">
R</label><div class="tabbed-content docutils">
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>library(DoubleML)
<span class="linenos"> 2</span>data = fetch_401k(return_type=&#39;data.table&#39;)
<span class="linenos"> 3</span># Construct DoubleMLData object from data.table
<span class="linenos"> 4</span>dml_data = DoubleMLData$new(data, y_col=&#39;net_tfa&#39;, d_cols=&#39;e401&#39;,
<span class="linenos"> 5</span>                        x_cols=c(&#39;age&#39;, &#39;inc&#39;, &#39;educ&#39;, &#39;fsize&#39;,
<span class="linenos"> 6</span>                                 &#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;,
<span class="linenos"> 7</span>                                 &#39;hown&#39;))
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>data_frame = fetch_401k(return_type=&#39;data.frame&#39;)
<span class="linenos">10</span># Construct DoubleMLData object from data.frame
<span class="linenos">11</span>dml_data_df = double_ml_data_from_data_frame(data_frame,
<span class="linenos">12</span>                                             y_col=&#39;net_tfa&#39;,
<span class="linenos">13</span>                                             d_cols=&#39;e401&#39;,
<span class="linenos">14</span>                                             x_cols=c(&#39;age&#39;, &#39;inc&#39;,
<span class="linenos">15</span>                                                      &#39;educ&#39;, &#39;fsize&#39;,
<span class="linenos">16</span>                                                      &#39;marr&#39;, &#39;twoearn&#39;,
<span class="linenos">17</span>                                                      &#39;db&#39;, &#39;pira&#39;,
<span class="linenos">18</span>                                                      &#39;hown&#39;))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</div>
</div>
</div>
<div class="section" id="causal-model">
<h2>2. Causal Model<a class="headerlink" href="#causal-model" title="Permalink to this headline">Â¶</a></h2>
<p>In Step 2. we choose a causal model. There are several models currently implemented in <a class="reference internal" href="../index.html#doubleml-package"><span class="std std-ref">DoubleML</span></a> which
differ in terms of the underlying causal structure (e.g., including IV variables or not) and the underlying assumptions.</p>
<a class="reference internal image-reference" href="../_images/doubleml_models.svg"><img alt="DoubleML Models" class="align-center" src="../_images/doubleml_models.svg" width="800" /></a>
<p>According to the previous discussion, we are interested in estimation of the effect of eligibility on net financial assets.
Hence, we do not need to use a model with both a treatment and instrumental variable. There are two potential models,
the <a class="reference internal" href="../guide/models.html#plr-model"><span class="std std-ref">partially linear regression model (PLR)</span></a> and the <a class="reference internal" href="../guide/models.html#irm-model"><span class="std std-ref">interactive regression model (IRM)</span></a>. These models differ
in terms of the type of the treatment variable (continuous vs. binary treatment) and the assumptions underlying the regression
equation. For example, the PLR assumes a partially linear structure, whereas the IRM allows treatment effects to be heterogeneous across
individuals. To keep the presentation short, we will choose a partially linear model.</p>
</div>
<div class="section" id="ml-methods">
<h2>3. ML Methods<a class="headerlink" href="#ml-methods" title="Permalink to this headline">Â¶</a></h2>
<p>In Step 3. we can specify the machine learning tools used for estimation of the nuisance parts.
We can generally choose any learner from <a class="reference external" href="https://scikit-learn.org">scikit learn</a> in Python and from the <a class="reference external" href="https://mlr3.mlr-org.com">mlr3</a> ecosystem in R.</p>
<p>There are two nuisance parts in the PLR, <span class="math notranslate nohighlight">\(g_0(X)=\mathbb{E}(Y|X)\)</span> and  <span class="math notranslate nohighlight">\(m_0(X)=\mathbb{E}(D|X)\)</span>.
In this example, let us specify a random forest and an xgboost learner for both prediction problems.
We can directly pass the parameters during initialization of the learner objects.
Because we have a binary treatment variable, we can use a classification learner for the corresponding nuisance part.
We use a regression learner for the continuous outcome variable net financial assets.</p>
<div class="tabbed-set docutils">
<input checked="checked" id="9e9f60ee-2f0d-4f91-b51c-1930d918a2b5" name="0dfa897c-615c-4a64-941d-595d326d89bf" type="radio">
</input><label class="tabbed-label" for="9e9f60ee-2f0d-4f91-b51c-1930d918a2b5">
Python</label><div class="tabbed-content docutils">
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># Random forest learners</span>
<span class="gp">In [5]: </span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span>

<span class="gp">In [6]: </span><span class="n">ml_g_rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
<span class="gp">   ...: </span>                                <span class="n">max_features</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [7]: </span><span class="n">ml_m_rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">   ...: </span>                                <span class="n">max_features</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="go"># Xgboost learners</span>
<span class="gp">In [8]: </span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span><span class="p">,</span> <span class="n">XGBRegressor</span>

<span class="gp">In [9]: </span><span class="n">ml_g_xgb</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;reg:squarederror&quot;</span><span class="p">,</span> <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="gp">   ...: </span>                        <span class="n">n_estimators</span> <span class="o">=</span><span class="mi">35</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [10]: </span><span class="n">ml_m_xgb</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">use_label_encoder</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">,</span>
<span class="gp">   ....: </span>                        <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;binary:logistic&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>                        <span class="n">eval_metric</span> <span class="o">=</span> <span class="s2">&quot;logloss&quot;</span><span class="p">,</span>
<span class="gp">   ....: </span>                        <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
<input id="ea8f708f-7f32-493a-b500-5afac0be1620" name="0dfa897c-615c-4a64-941d-595d326d89bf" type="radio">
</input><label class="tabbed-label" for="ea8f708f-7f32-493a-b500-5afac0be1620">
R</label><div class="tabbed-content docutils">
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">library</span><span class="p">(</span><span class="n">mlr3</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="n">library</span><span class="p">(</span><span class="n">mlr3learners</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="c1"># Random forest learners</span>
<span class="linenos"> 4</span><span class="n">ml_g_rf</span> <span class="o">=</span> <span class="n">lrn</span><span class="p">(</span><span class="s2">&quot;regr.ranger&quot;</span><span class="p">,</span> <span class="nb">max</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
<span class="linenos"> 5</span>            <span class="n">mtry</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">min</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos"> 6</span><span class="n">ml_m_rf</span> <span class="o">=</span> <span class="n">lrn</span><span class="p">(</span><span class="s2">&quot;classif.ranger&quot;</span><span class="p">,</span> <span class="nb">max</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="linenos"> 7</span>            <span class="n">mtry</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">min</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c1"># Xgboost learners</span>
<span class="linenos">10</span><span class="n">ml_g_xgb</span> <span class="o">=</span> <span class="n">lrn</span><span class="p">(</span><span class="s2">&quot;regr.xgboost&quot;</span><span class="p">,</span> <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;reg:squarederror&quot;</span><span class="p">,</span>
<span class="linenos">11</span>                <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">nrounds</span> <span class="o">=</span> <span class="mi">35</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">ml_m_xgb</span> <span class="o">=</span> <span class="n">lrn</span><span class="p">(</span><span class="s2">&quot;classif.xgboost&quot;</span><span class="p">,</span> <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;binary:logistic&quot;</span><span class="p">,</span>
<span class="linenos">13</span>                <span class="n">eval_metric</span> <span class="o">=</span> <span class="s2">&quot;logloss&quot;</span><span class="p">,</span>
<span class="linenos">14</span>                <span class="n">eta</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">nrounds</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</div>
</div>
</div>
<div class="section" id="dml-specifications">
<h2>4. DML Specifications<a class="headerlink" href="#dml-specifications" title="Permalink to this headline">Â¶</a></h2>
<p>In Step 4., we initialize and parametrize the model object which will later be used to perform the estimation.</p>
<p>We initialize a <a class="reference external" href="https://docs.doubleml.org/stable/api/generated/doubleml.DoubleMLPLR.html">DoubleMLPLR (Python)</a> /
<a class="reference external" href="https://docs.doubleml.org/r/stable/reference/DoubleMLPLR.html">DoubleMLPLR (R)</a>
object using the previously generated data-backend. Moreover, we specify the resampling
(= the number of repetitions and folds for <a class="reference internal" href="../guide/resampling.html#repeated-cross-fitting"><span class="std std-ref">repeated cross-fitting</span></a>),
the dml algorithm (<a class="reference internal" href="../guide/algorithms.html#algorithms"><span class="std std-ref">DML1 vs. DML2</span></a>) and the score function (<a class="reference internal" href="../guide/scores.html#plr-score"><span class="std std-ref">âpartialling outâ or
âIV-typeâ</span></a>).</p>
<div class="tabbed-set docutils">
<input checked="checked" id="f5822f0b-dade-40b0-8fd7-944fe6e6cbca" name="848b9811-cecc-42c1-a2ab-05429858ad2a" type="radio">
</input><label class="tabbed-label" for="f5822f0b-dade-40b0-8fd7-944fe6e6cbca">
Python</label><div class="tabbed-content docutils">
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="kn">from</span> <span class="nn">doubleml</span> <span class="kn">import</span> <span class="n">DoubleMLPLR</span>

<span class="gp">In [12]: </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="go"># Default values</span>
<span class="gp">In [13]: </span><span class="n">dml_plr_tree</span> <span class="o">=</span> <span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">dml_data</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">ml_g</span> <span class="o">=</span> <span class="n">ml_g_rf</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">ml_m</span> <span class="o">=</span> <span class="n">ml_m_rf</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [14]: </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="go"># Parametrized by user</span>
<span class="gp">In [15]: </span><span class="n">dml_plr_tree</span> <span class="o">=</span> <span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">dml_data</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">ml_g</span> <span class="o">=</span> <span class="n">ml_g_rf</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">ml_m</span> <span class="o">=</span> <span class="n">ml_m_rf</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">n_rep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">score</span> <span class="o">=</span> <span class="s1">&#39;partialling out&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>                            <span class="n">dml_procedure</span> <span class="o">=</span> <span class="s1">&#39;dml2&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
<input id="97e7ea1a-ab4c-49c0-abb9-d98a926a4e1c" name="848b9811-cecc-42c1-a2ab-05429858ad2a" type="radio">
</input><label class="tabbed-label" for="97e7ea1a-ab4c-49c0-abb9-d98a926a4e1c">
R</label><div class="tabbed-content docutils">
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>set.seed(123)
<span class="linenos"> 2</span># Default values
<span class="linenos"> 3</span>dml_plr_forest = DoubleMLPLR$new(dml_data,
<span class="linenos"> 4</span>                                ml_g = ml_g_rf,
<span class="linenos"> 5</span>                                ml_m = ml_m_rf)
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>set.seed(123)
<span class="linenos"> 8</span># Parametrized by user
<span class="linenos"> 9</span>dml_plr_forest = DoubleMLPLR$new(dml_data,
<span class="linenos">10</span>                                ml_g = ml_g_rf,
<span class="linenos">11</span>                                ml_m = ml_m_rf,
<span class="linenos">12</span>                                n_folds = 3,
<span class="linenos">13</span>                                score = &#39;partialling out&#39;,
<span class="linenos">14</span>                                dml_procedure = &#39;dml2&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</div>
</div>
</div>
<div class="section" id="estimation">
<h2>5. Estimation<a class="headerlink" href="#estimation" title="Permalink to this headline">Â¶</a></h2>
<p>We perform estimation in Step 5. In this step, the cross-fitting algorithm is executed such that the predictions
in the score are computed. As an output, users can access the coefficient estimates and standard errors either via the
corresponding fields or via a summary.</p>
<div class="tabbed-set docutils">
<input checked="checked" id="1e745096-c6d6-4343-a42d-23fe89cabbed" name="fa74691a-b150-4164-95f5-a599cd7806c0" type="radio">
</input><label class="tabbed-label" for="1e745096-c6d6-4343-a42d-23fe89cabbed">
Python</label><div class="tabbed-content docutils">
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># Estimation</span>
<span class="gp">In [16]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="gh">Out[16]: </span><span class="go">&lt;doubleml.double_ml_plr.DoubleMLPLR at 0x7f8710c24460&gt;</span>

<span class="go"># Coefficient estimate</span>
<span class="gp">In [17]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">coef</span>
<span class="gh">Out[17]: </span><span class="go">array([8909.63407762])</span>

<span class="go"># Standard error</span>
<span class="gp">In [18]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">se</span>
<span class="gh">Out[18]: </span><span class="go">array([1321.82228913])</span>

<span class="go"># Summary</span>
<span class="gp">In [19]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">summary</span>
<span class="gh">Out[19]: </span><span class="go"></span>
<span class="go">             coef      std err  ...        2.5 %        97.5 %</span>
<span class="go">e401  8909.634078  1321.822289  ...  6318.909997  11500.358158</span>

<span class="go">[1 rows x 6 columns]</span>
</pre></div>
</div>
</div>
<input id="ec01541f-f2ff-453d-8456-f11f61346a86" name="fa74691a-b150-4164-95f5-a599cd7806c0" type="radio">
</input><label class="tabbed-label" for="ec01541f-f2ff-453d-8456-f11f61346a86">
R</label><div class="tabbed-content docutils">
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span># Estimation
<span class="linenos"> 2</span>dml_plr_forest$fit()
<span class="linenos"> 3</span>
<span class="linenos"> 4</span># Coefficient estimate
<span class="linenos"> 5</span>dml_plr_forest$coef
<span class="linenos"> 6</span>
<span class="linenos"> 7</span># Standard error
<span class="linenos"> 8</span>dml_plr_forest$se
<span class="linenos"> 9</span>
<span class="linenos">10</span># Summary
<span class="linenos">11</span>dml_plr_forest$summary()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>INFO  [09:33:09.616] [mlr3]  Applying learner &#39;regr.ranger&#39; on task &#39;nuis_g&#39; (iter 2/3) 
INFO  [09:33:12.308] [mlr3]  Applying learner &#39;regr.ranger&#39; on task &#39;nuis_g&#39; (iter 3/3) 
INFO  [09:33:13.912] [mlr3]  Applying learner &#39;regr.ranger&#39; on task &#39;nuis_g&#39; (iter 1/3) 
INFO  [09:33:15.674] [mlr3]  Applying learner &#39;classif.ranger&#39; on task &#39;nuis_m&#39; (iter 3/3) 
INFO  [09:33:17.095] [mlr3]  Applying learner &#39;classif.ranger&#39; on task &#39;nuis_m&#39; (iter 2/3) 
INFO  [09:33:18.418] [mlr3]  Applying learner &#39;classif.ranger&#39; on task &#39;nuis_m&#39; (iter 1/3) 
</pre></div>
</div>
<div class="output text_html"><strong>e401:</strong> 9126.99864670889</div><div class="output text_html"><strong>e401:</strong> 1312.93958082416</div><div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>[1] &quot;Estimates and significance testing of the effect of target variables&quot;
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      9127       1313   6.952 3.61e-12 ***
---
Signif. codes:  0 â***â 0.001 â**â 0.01 â*â 0.05 â.â 0.1 â â 1


</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="inference">
<h2>6. Inference<a class="headerlink" href="#inference" title="Permalink to this headline">Â¶</a></h2>
<p>In Step 6. we can perform further inference methods and finally interpret our findings. For example, we can set up confidence intervals
or, in case multiple causal parameters are estimated, adjust the analysis for multiple testing. <a class="reference internal" href="../index.html#doubleml-package"><span class="std std-ref">DoubleML</span></a>
supports various approaches to perform <a class="reference internal" href="../guide/sim_inf.html#sim-inf"><span class="std std-ref">valid simultaneous inference</span></a>
which are partly based on a multiplier bootstrap.</p>
<p>To conclude the analysis on the intent-to-treat effect in the 401(k) example, i.e., the average treatment effect of eligibility for 401(k) pension plans
on net financial assets, we find a positive and significant effect: Being eligible for such a pension plan increases the amount of net financial assets by
approximately <span class="math notranslate nohighlight">\($9,000\)</span>. This estimate is much smaller than the unconditional effect of eligibility on net financial assets:
If we did not control for the confounding variables, the average treatment effect would correspond to <span class="math notranslate nohighlight">\($19,559\)</span>.</p>
<div class="tabbed-set docutils">
<input checked="checked" id="6d539f33-5432-4be0-a2e4-37a3c9e35475" name="806c0832-06a3-412e-8ce1-e60e78c69550" type="radio">
</input><label class="tabbed-label" for="6d539f33-5432-4be0-a2e4-37a3c9e35475">
Python</label><div class="tabbed-content docutils">
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># Summary</span>
<span class="gp">In [20]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">summary</span>
<span class="gh">Out[20]: </span><span class="go"></span>
<span class="go">             coef      std err  ...        2.5 %        97.5 %</span>
<span class="go">e401  8909.634078  1321.822289  ...  6318.909997  11500.358158</span>

<span class="go">[1 rows x 6 columns]</span>

<span class="go"># Confidence intervals</span>
<span class="gp">In [21]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">confint</span><span class="p">()</span>
<span class="gh">Out[21]: </span><span class="go"></span>
<span class="go">            2.5 %        97.5 %</span>
<span class="go">e401  6318.909997  11500.358158</span>

<span class="go"># Multiplier bootstrap (relevant in case with multiple treatment variables)</span>
<span class="gp">In [22]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">()</span>
<span class="gh">Out[22]: </span><span class="go">&lt;doubleml.double_ml_plr.DoubleMLPLR at 0x7f8710c24460&gt;</span>

<span class="go"># Simultaneous confidence bands</span>
<span class="gp">In [23]: </span><span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">confint</span><span class="p">(</span><span class="n">joint</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[23]: </span><span class="go"></span>
<span class="go">            2.5 %        97.5 %</span>
<span class="go">e401  6075.923943  11743.344212</span>
</pre></div>
</div>
</div>
<input id="cdb88bec-dcc6-4aaf-bdb1-49051858548b" name="806c0832-06a3-412e-8ce1-e60e78c69550" type="radio">
</input><label class="tabbed-label" for="cdb88bec-dcc6-4aaf-bdb1-49051858548b">
R</label><div class="tabbed-content docutils">
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span># Summary
<span class="linenos"> 2</span>dml_plr_forest$summary()
<span class="linenos"> 3</span>
<span class="linenos"> 4</span># Confidence intervals
<span class="linenos"> 5</span>dml_plr_forest$confint()
<span class="linenos"> 6</span>
<span class="linenos"> 7</span># Multiplier bootstrap (relevant in case with multiple treatment variables)
<span class="linenos"> 8</span>dml_plr_forest$bootstrap()
<span class="linenos"> 9</span>
<span class="linenos">10</span># Simultaneous confidence bands
<span class="linenos">11</span>dml_plr_forest$confint(joint = TRUE)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>[1] &quot;Estimates and significance testing of the effect of target variables&quot;
     Estimate. Std. Error t value Pr(&gt;|t|)    
e401      9127       1313   6.952 3.61e-12 ***
---
Signif. codes:  0 â***â 0.001 â**â 0.01 â*â 0.05 â.â 0.1 â â 1


</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 1 Ã 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>2.5 %</th><th scope=col>97.5 %</th></tr>
</thead>
<tbody>
	<tr><th scope=row>e401</th><td>6553.684</td><td>11700.31</td></tr>
</tbody>
</table>
</div><div class="output text_html"><table class="dataframe">
<caption>A matrix: 1 Ã 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>2.5 %</th><th scope=col>97.5 %</th></tr>
</thead>
<tbody>
	<tr><th scope=row>e401</th><td>6553.428</td><td>11700.57</td></tr>
</tbody>
</table>
</div></div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="../guide/resampling.html" title="previous page"><span class="section-number">9. </span>Sample-splitting, cross-fitting and repeated cross-fitting</a>
    <a class='right-next' id="next-link" href="../api/api.html" title="next page">API reference</a>

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Bach, P., Chernozhukov, V., Kurz, M. S., and Spindler, M..<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.0.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>