
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DoubleML Workflow &#8212; DoubleML  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API reference" href="../api/api.html" />
    <link rel="prev" title="9. Sample-splitting, cross-fitting and repeated cross-fitting" href="../guide/resampling.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">DoubleML  documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  DoubleML
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../intro/install.html">
  Install
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../intro/intro.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../guide/guide.html">
  User guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Workflow
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api.html">
  Python API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://docs.doubleml.org/r/stable/">
  R API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples/index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../literature/literature.html">
  Literature
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../release/release.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/DoubleML/doubleml-for-py" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><p class="logo" style="text-align:center;"><a href="../index.html">
    <img class="logo" src="../logo.png" alt="Logo" width="65%" height="65%">
</a></p><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav><style>

.toc-entry {
  list-style: none;
  margin-left: 0em;
  min-height: 50px;
  border-left: 2px solid rgba(var(--pst-color-text-base), 1);
  padding: 0 0 50px 0px;
  position: relative;
}
.toc-entry:last-child{
  border-left: 0;
  left: 2px;
}

.toc-entry::after{
  border-left: 0;
  position: absolute;
  left: -8px;
  top: 0px;
  content: " ";
  border: 2px solid rgba(255, 255, 255, 1);
  border-radius: 500%;
  background: rgba(var(--pst-color-toc-link-active), 1);
  height: 15px;
  width: 15px;
}

.toc-entry:hover::after {
  background: rgba(var(--pst-color-link-hover), 1);
  transition: all 200ms ease-in-out;
}

.toc-entry > .nav-link {
  position: relative;
  font-size: small;
  font-weight: 600;
  text-align: left;
  margin: 0;
  top: -5px;
  color: rgba(var(--pst-color-text-base), 1);
}

.toc-entry > .nav-link.active {
  color: rgba(255, 255, 255, 1);
  font-size: medium;
  background-color: rgba(var(--pst-color-toc-link-active), 1);
  border-bottom-right-radius: 20px;
  border-top-right-radius: 20px;
  border-left: 0;
  margin-left: 2px;
  padding-right: 15px;
  top: -7px;
  transition: background-color 200ms ease-in-out, color 200ms ease-in-out, border 200ms ease-in-out, font-size 200ms ease-in-out;
}

</style>

  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-formulation">
   0. Problem Formulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-backend">
   1. Data-Backend
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#causal-model">
   2. Causal Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ml-methods">
   3. ML Methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dml-specifications">
   4. DML Specifications
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimation">
   5. Estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inference">
   6. Inference
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="doubleml-workflow">
<h1>DoubleML Workflow<a class="headerlink" href="#doubleml-workflow" title="Permalink to this heading">#</a></h1>
<p>The following steps, which we call the DoubleML workflow, are intended to provide a rough structure for causal analyses
with <a class="reference internal" href="../index.html#doubleml-package"><span class="std std-ref">DoubleML</span></a>. After a short explanation of the idea of each step, we illustrate their meaning in the 401(k)
example. In case you are interested in more details of the 401(k) example, you can visit the
<a class="reference external" href="https://docs.doubleml.org/stable/examples/py_double_ml_pension.html">Python</a> and <a class="reference external" href="https://docs.doubleml.org/stable/examples/R_double_ml_pension.html">R</a>
Notebooks that are available online.</p>
<section id="problem-formulation">
<h2>0. Problem Formulation<a class="headerlink" href="#problem-formulation" title="Permalink to this heading">#</a></h2>
<p>The initial step of the DoubleML workflow is to formulate the causal problem at hand. Before we start our statistical
analysis, we have to explicitly state the conditions required for a causal interpretation of the estimator, which will
be computed later. In many cases, directed acyclical graphs (DAGs) are helpful to formulate the causal problem,
illustrate the involved causal channels and the critical parts of the inferential framework. At this stage, a precise
argumentation and discussion of the research question is crucial.</p>
<a class="reference internal image-reference" href="../_images/causal_graph.svg"><img alt="DAG for the 401(k) Example" class="align-center" src="../_images/causal_graph.svg" width="800" /></a>
<p>In the 401(k) study, we are interested in estimating the average treatment effect of participation in so-called 401(k) pension
plans on employees’ net financial assets. Because we cannot rely on a properly conducted randomized control study in this
example, we have to base our analysis on observational data. Hence, we have to use an identification strategy that is based
on appropriately controlling for potential confounders.
A complication that arises in the 401(k) example is due to so-called endogeneity of the treatment assignment. The treatment
variable is an employee’s participation in a 401(k) pension plan which is a decision made by employees and likely
to be affected by unobservable effects. For example, is seems reasonable that persons with higher income have stronger
preferences to save and also to participate in a pension plan. If our analysis does not account for this self-selection into
treatment, the estimated effect is likely to be biased.</p>
<p>To circumvent the endogenous treatment problem, it is possible to exploit randomness in eligibility for 401(k) plans.
In other words, the access to the treatment can be considered as randomly assigned once we control for confounding variables.
Earlier studies in this context argue that if characteristics that are related to saving preferences are taken into account,
eligibility can be considered as good as randomly assigned (at the time 401(k) plans were introduced).
The conditional exogeneity in the access to treatment makes it possible to estimate the causal effect of interest by using
an instrumental variable (IV) approach. However, for the sake of brevity, we will focus on the so-called intent-to-treat effect in the following.
This effect corresponds to the average treatment effect of eligibility (= the instrument) on net financial assets (= the outcome) and
is of great interest in many applications. The IV analysis is available in the <a class="reference external" href="https://docs.doubleml.org/stable/examples/py_double_ml_pension.html">Python</a>
and <a class="reference external" href="https://docs.doubleml.org/stable/examples/R_double_ml_pension.html">R</a> Notebooks that are available online.</p>
<p>The previous discussion focuses on the causal problem. Let’s also talk about the statistical methods used for estimation.
For identification of the average treatment effect of participation or eligibility on assets, it is crucial that we appropriately
account for the confounding factors. That’s where the machine learning tools come into play. Of course, we could simply estimate
the causal effect by using a classical linear (IV) regression model: The researcher has to manually pick and, perhaps,
transform the confounding variables in the regression model.
However, machine learning techniques offer greater flexibility in terms of a more data-driven specification
of the main regression equation and the first stage.</p>
</section>
<section id="data-backend">
<h2>1. Data-Backend<a class="headerlink" href="#data-backend" title="Permalink to this heading">#</a></h2>
<p>In step 1., we initialize the data-backend and thereby declare the role of the outcome, the treatment, and the confounding variables.</p>
<p>We use data from the 1991 Survey of Income and Program Participation which is available via the function
<a class="reference external" href="https://docs.doubleml.org/stable/api/generated/doubleml.datasets.fetch_401K.html">fetch_401K (Python)</a>
or <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/fetch_401k.html">fetch_401k (R)</a>.
The data-backend can be initialized from various data frame objects in Python and R. To estimate the intent-to-treat effect in the
401(k) example, we use eligibility (<code class="docutils literal notranslate"><span class="pre">e401</span></code>) as the treatment variable of interest. The outcome variable is <code class="docutils literal notranslate"><span class="pre">net_tfa</span></code> and we
control for confounding variables <code class="docutils literal notranslate"><span class="pre">['age',</span> <span class="pre">'inc',</span> <span class="pre">'educ',</span> <span class="pre">'fsize',</span> <span class="pre">'marr',</span> <span class="pre">'twoearn',</span> <span class="pre">'db',</span> <span class="pre">'pira',</span> <span class="pre">'hown']</span></code>.</p>
</section>
<section id="causal-model">
<h2>2. Causal Model<a class="headerlink" href="#causal-model" title="Permalink to this heading">#</a></h2>
<p>In Step 2. we choose a causal model. There are several models currently implemented in <a class="reference internal" href="../index.html#doubleml-package"><span class="std std-ref">DoubleML</span></a> which
differ in terms of the underlying causal structure (e.g., including IV variables or not) and the underlying assumptions.</p>
<a class="reference internal image-reference" href="../_images/doubleml_models.svg"><img alt="DoubleML Models" class="align-center" src="../_images/doubleml_models.svg" width="800" /></a>
<p>According to the previous discussion, we are interested in estimation of the effect of eligibility on net financial assets.
Hence, we do not need to use a model with both a treatment and instrumental variable. There are two potential models,
the <a class="reference internal" href="../guide/models.html#plr-model"><span class="std std-ref">partially linear regression model (PLR)</span></a> and the <a class="reference internal" href="../guide/models.html#irm-model"><span class="std std-ref">interactive regression model (IRM)</span></a>. These models differ
in terms of the type of the treatment variable (continuous vs. binary treatment) and the assumptions underlying the regression
equation. For example, the PLR assumes a partially linear structure, whereas the IRM allows treatment effects to be heterogeneous across
individuals. To keep the presentation short, we will choose a partially linear model.</p>
</section>
<section id="ml-methods">
<h2>3. ML Methods<a class="headerlink" href="#ml-methods" title="Permalink to this heading">#</a></h2>
<p>In Step 3. we can specify the machine learning tools used for estimation of the nuisance parts.
We can generally choose any learner from <a class="reference external" href="https://scikit-learn.org">scikit learn</a> in Python and from the <a class="reference external" href="https://mlr3.mlr-org.com">mlr3</a> ecosystem in R.</p>
<p>There are two nuisance parts in the PLR, <span class="math notranslate nohighlight">\(g_0(X)=\mathbb{E}(Y|X)\)</span> and  <span class="math notranslate nohighlight">\(m_0(X)=\mathbb{E}(D|X)\)</span>.
In this example, let us specify a random forest and an xgboost learner for both prediction problems.
We can directly pass the parameters during initialization of the learner objects.
Because we have a binary treatment variable, we can use a classification learner for the corresponding nuisance part.
We use a regression learner for the continuous outcome variable net financial assets.</p>
</section>
<section id="dml-specifications">
<h2>4. DML Specifications<a class="headerlink" href="#dml-specifications" title="Permalink to this heading">#</a></h2>
<p>In Step 4., we initialize and parametrize the model object which will later be used to perform the estimation.</p>
<p>We initialize a <a class="reference external" href="https://docs.doubleml.org/stable/api/generated/doubleml.DoubleMLPLR.html">DoubleMLPLR (Python)</a> /
<a class="reference external" href="https://docs.doubleml.org/r/stable/reference/DoubleMLPLR.html">DoubleMLPLR (R)</a>
object using the previously generated data-backend. Moreover, we specify the resampling
(= the number of repetitions and folds for <a class="reference internal" href="../guide/resampling.html#repeated-cross-fitting"><span class="std std-ref">repeated cross-fitting</span></a>),
the dml algorithm (<a class="reference internal" href="../guide/algorithms.html#algorithms"><span class="std std-ref">DML1 vs. DML2</span></a>) and the score function (<a class="reference internal" href="../guide/scores.html#plr-score"><span class="std std-ref">“partialling out” or
“IV-type”</span></a>).</p>
</section>
<section id="estimation">
<h2>5. Estimation<a class="headerlink" href="#estimation" title="Permalink to this heading">#</a></h2>
<p>We perform estimation in Step 5. In this step, the cross-fitting algorithm is executed such that the predictions
in the score are computed. As an output, users can access the coefficient estimates and standard errors either via the
corresponding fields or via a summary.</p>
</section>
<section id="inference">
<h2>6. Inference<a class="headerlink" href="#inference" title="Permalink to this heading">#</a></h2>
<p>In Step 6. we can perform further inference methods and finally interpret our findings. For example, we can set up confidence intervals
or, in case multiple causal parameters are estimated, adjust the analysis for multiple testing. <a class="reference internal" href="../index.html#doubleml-package"><span class="std std-ref">DoubleML</span></a>
supports various approaches to perform <a class="reference internal" href="../guide/sim_inf.html#sim-inf"><span class="std std-ref">valid simultaneous inference</span></a>
which are partly based on a multiplier bootstrap.</p>
<p>To conclude the analysis on the intent-to-treat effect in the 401(k) example, i.e., the average treatment effect of eligibility for 401(k) pension plans
on net financial assets, we find a positive and significant effect: Being eligible for such a pension plan increases the amount of net financial assets by
approximately <span class="math notranslate nohighlight">\($9,000\)</span>. This estimate is much smaller than the unconditional effect of eligibility on net financial assets:
If we did not control for the confounding variables, the average treatment effect would correspond to <span class="math notranslate nohighlight">\($19,559\)</span>.</p>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../guide/resampling.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title"><span class="section-number">9. </span>Sample-splitting, cross-fitting and repeated cross-fitting</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../api/api.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">API reference</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2021, Bach, P., Chernozhukov, V., Kurz, M. S., and Spindler, M..<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.0.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>