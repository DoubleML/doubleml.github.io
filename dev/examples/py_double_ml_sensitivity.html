

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Python: Sensitivity Analysis &#8212; DoubleML  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/py_double_ml_sensitivity';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python: Policy Learning with Trees" href="py_double_ml_policy_tree.html" />
    <link rel="prev" title="Python: Choice of learners" href="py_double_ml_learner.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">DoubleML  documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../intro/install.html">
                         Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../intro/intro.html">
                         Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../workflow/workflow.html">
                         Workflow
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../guide/guide.html">
                         User guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                         Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/api.html">
                         Python API
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://docs.doubleml.org/r/stable/">
                         R API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../literature/literature.html">
                         Literature
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../release/release.html">
                         Release notes
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DoubleML/doubleml-for-py" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../intro/install.html">
                         Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../intro/intro.html">
                         Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../workflow/workflow.html">
                         Workflow
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../guide/guide.html">
                         User guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                         Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/api.html">
                         Python API
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://docs.doubleml.org/r/stable/">
                         R API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../literature/literature.html">
                         Literature
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../release/release.html">
                         Release notes
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/DoubleML/doubleml-for-py" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><p class="logo" style="text-align:center;"><a href="../index.html">
    <img class="logo" src="../logo.png" alt="Logo" width="65%" height="65%">
</a></p>

<script type="text/javascript">
    // Change the logo depending on the theme
    var logo = document.querySelector('img.logo');
    var observer = new MutationObserver(function(mutations) {
        const dark = document.documentElement.dataset.theme == 'dark';
        if (dark) {
            logo.src = "../logo_dark.png";
        } else {
            logo.src = "../logo.png";
        }
    });
    observer.observe(document.documentElement, {attributes: true, attributeFilter: ['data-theme']});
</script></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="R_double_ml_pension.html">R: Impact of 401(k) on Financial Wealth</a></li>
<li class="toctree-l1"><a class="reference internal" href="r_double_ml_multiway_cluster.html">R: Cluster Robust Double Machine Learning</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_pension.html">Python: Impact of 401(k) on Financial Wealth</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_multiway_cluster.html">Python: Cluster Robust Double Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_gate.html">Python: Group Average Treatment Effects (GATEs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_cate.html">Python: Conditional Average Treatment Effects (CATEs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_did.html">Python: Difference-in-Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_did_pretest.html">Python: Difference-in-Differences Pre-Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_pension_qte.html">Python: Impact of 401(k) on Financial Wealth (Quantile Effects)</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_pq.html">Python: Potential Quantiles and Quantile Treatment Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_cvar.html">Python: Conditional Value at Risk of potential outcomes</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_learner.html">Python: Choice of learners</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Python: Sensitivity Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_double_ml_policy_tree.html">Python: Policy Learning with Trees</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="R_double_ml_pipeline.html">R: Ensemble Learners and More with <code class="docutils literal notranslate"><span class="pre">mlr3pipelines</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="double_ml_bonus_data.html">DML: Bonus Data</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Python: Sensitivity Analysis</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
      <div class="admonition note">
    <p class="admonition-title">Note</p>
    <ul class="simple">

Download Jupyter notebook:
<a class="reference external" href="https://docs.doubleml.org/stable/examples/py_double_ml_sensitivity.ipynb">https://docs.doubleml.org/stable/examples/py_double_ml_sensitivity.ipynb</a>.

    </ul>
    </div><section id="Python:-Sensitivity-Analysis">
<h1>Python: Sensitivity Analysis<a class="headerlink" href="#Python:-Sensitivity-Analysis" title="Permalink to this heading">#</a></h1>
<p>This notebook illustrates the sensitivity analysis tools with the partiallly linear regression model (PLR). The DoubleML package implements sensitivity analysis based on <a class="reference external" href="https://www.nber.org/papers/w30302">Chernozhukov et al. (2022)</a>.</p>
<section id="Simulation-Example">
<h2>Simulation Example<a class="headerlink" href="#Simulation-Example" title="Permalink to this heading">#</a></h2>
<p>For illustration purposes, we will work with generated data. This enables us to set the counfounding strength, such that we can correctly access quality of e.g. the robustness values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span>

<span class="kn">import</span> <span class="nn">doubleml</span> <span class="k">as</span> <span class="nn">dml</span>
<span class="kn">from</span> <span class="nn">doubleml.datasets</span> <span class="kn">import</span> <span class="n">make_confounded_plr_data</span><span class="p">,</span> <span class="n">fetch_401K</span>
</pre></div>
</div>
</div>
<section id="Data">
<h3>Data<a class="headerlink" href="#Data" title="Permalink to this heading">#</a></h3>
<p>The data will be generated via <code class="docutils literal notranslate"><span class="pre">make_confounded_plr_data</span></code> and set the confounding values to <code class="docutils literal notranslate"><span class="pre">cf_y=0.1</span></code> and <code class="docutils literal notranslate"><span class="pre">cf_d=0.1</span></code>.</p>
<p>Both parameters determine the strength of the confounding</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cf_y</span></code> measures the proportion of residual variance in the outcome explained by unobserved confounders</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cf_d</span></code> measires the porportion of residual variance of the treatment representer generated by unobserved confounders.</p></li>
</ul>
<p>For further details, see <a class="reference external" href="https://www.nber.org/papers/w30302">Chernozhukov et al. (2022)</a> or <a class="reference external" href="https://docs.doubleml.org/stable/guide/guide.html">User guide</a>. Further, the true treatment effect is set to <code class="docutils literal notranslate"><span class="pre">theta=5.0</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cf_y</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">cf_d</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">5.0</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">dpg_dict</span> <span class="o">=</span> <span class="n">make_confounded_plr_data</span><span class="p">(</span><span class="n">n_obs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cf_y</span><span class="o">=</span><span class="n">cf_y</span><span class="p">,</span> <span class="n">cf_d</span><span class="o">=</span><span class="n">cf_d</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
<span class="n">x_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;X</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dpg_dict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">dpg_dict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">dpg_dict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">dpg_dict</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">])),</span> <span class="n">columns</span><span class="o">=</span><span class="n">x_cols</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
<span class="n">dml_data</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLData</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== DoubleMLData Object ==================

------------------ Data summary      ------------------
Outcome variable: y
Treatment variable(s): [&#39;d&#39;]
Covariates: [&#39;X1&#39;, &#39;X2&#39;, &#39;X3&#39;, &#39;X4&#39;]
Instrument variable(s): None
No. Observations: 1000

------------------ DataFrame info    ------------------
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1000 entries, 0 to 999
Columns: 6 entries, X1 to d
dtypes: float64(6)
memory usage: 47.0 KB

</pre></div></div>
</div>
</section>
<section id="DoubleML-Object">
<h3>DoubleML Object<a class="headerlink" href="#DoubleML-Object" title="Permalink to this heading">#</a></h3>
<p>We fit a <code class="docutils literal notranslate"><span class="pre">DoubleMLPLR</span></code> object and use basic random forest to flexibly estimate the nuisance elements.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">dml_obj</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">dml_data</span><span class="p">,</span>
                          <span class="n">ml_l</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(),</span>
                          <span class="n">ml_m</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(),</span>
                          <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                          <span class="n">score</span><span class="o">=</span><span class="s1">&#39;partialling out&#39;</span><span class="p">)</span>
<span class="n">dml_obj</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== DoubleMLPLR Object ==================

------------------ Data summary      ------------------
Outcome variable: y
Treatment variable(s): [&#39;d&#39;]
Covariates: [&#39;X1&#39;, &#39;X2&#39;, &#39;X3&#39;, &#39;X4&#39;]
Instrument variable(s): None
No. Observations: 1000

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
Learner ml_l: RandomForestRegressor()
Learner ml_m: RandomForestRegressor()
Out-of-sample Performance:
Learner ml_l RMSE: [[11.82819715]]
Learner ml_m RMSE: [[1.11536544]]

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: True

------------------ Fit summary       ------------------
       coef  std err         t         P&gt;|t|    2.5 %    97.5 %
d  4.129914  0.45571  9.062601  1.273765e-19  3.23674  5.023089
</pre></div></div>
</div>
<p>The effect estimate is biased due to the unobserved confounding and the corresponding confidence interval does not cover the true parameter <code class="docutils literal notranslate"><span class="pre">theta=5.0</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dml_obj</span><span class="o">.</span><span class="n">confint</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
     2.5 %    97.5 %
d  3.23674  5.023089
</pre></div></div>
</div>
</section>
<section id="Sensitivity-Analysis">
<h3>Sensitivity Analysis<a class="headerlink" href="#Sensitivity-Analysis" title="Permalink to this heading">#</a></h3>
<p>To perform a sensitivity analysis with the <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> package you can use the <code class="docutils literal notranslate"><span class="pre">sensitivity_analysis()</span></code> method. The sensitivity analysis is based on the strength of the confounding <code class="docutils literal notranslate"><span class="pre">cf_y</span></code> and <code class="docutils literal notranslate"><span class="pre">cf_d</span></code> (default values <span class="math notranslate nohighlight">\(0.03\)</span>) and the parameter <code class="docutils literal notranslate"><span class="pre">rho</span></code>, which measures the correlation between the difference of the long and short form of the outcome regression and the Riesz representer (the default value <span class="math notranslate nohighlight">\(1.0\)</span> is conservative and
considers adversarial counfounding). To additionally incorporate statistical uncertainty, a significance level (default <span class="math notranslate nohighlight">\(0.95\)</span>) is used.</p>
<p>These input parameters are used to calculate upper and lower bounds (including the corresponding confidence level) on the treatment effect estimate.</p>
<p>Further, the sensitivity analysis includes a null hypothesis (default <span class="math notranslate nohighlight">\(0.0\)</span>), which is used to compute robustness values. The robustness value <span class="math notranslate nohighlight">\(RV\)</span> is defined as the required confounding strength (<code class="docutils literal notranslate"><span class="pre">cf_y=rv</span></code> and <code class="docutils literal notranslate"><span class="pre">cf_d=rv</span></code>), such that the lower or upper bound of the causal parameter includes the null hypothesis. The robustness value <span class="math notranslate nohighlight">\(RVa\)</span> defined analogous but additionally incorporates statistical uncertainty (as it is based on the confidence intervals of the bounds). For a
more detailed explanation see the <a class="reference external" href="https://docs.doubleml.org/stable/guide/guide.html">User Guide</a> or <a class="reference external" href="https://www.nber.org/papers/w30302">Chernozhukov et al. (2022)</a>.</p>
<p>The results of the analysis can be printed via the <code class="docutils literal notranslate"><span class="pre">sensitivity_summary</span></code> property or directly accessed via the <code class="docutils literal notranslate"><span class="pre">sensitivity_params</span></code> property.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_obj</span><span class="o">.</span><span class="n">sensitivity_analysis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_obj</span><span class="o">.</span><span class="n">sensitivity_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== Sensitivity Analysis ==================

------------------ Scenario          ------------------
Significance Level: level=0.95
Sensitivity parameters: cf_y=0.03; cf_d=0.03, rho=1.0

------------------ Bounds with CI    ------------------
   CI lower  theta lower     theta  theta upper  CI upper
d  3.097583     3.832391  4.129914     4.427438  5.192852

------------------ Robustness Values ------------------
   H_0     RV (%)    RVa (%)
d  0.0  34.277832  29.773191
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_obj</span><span class="o">.</span><span class="n">sensitivity_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;theta&#39;: {&#39;lower&#39;: array([3.83239096]), &#39;upper&#39;: array([4.42743757])},
 &#39;se&#39;: {&#39;lower&#39;: array([0.44673151]), &#39;upper&#39;: array([0.46533865])},
 &#39;ci&#39;: {&#39;lower&#39;: array([3.09758302]), &#39;upper&#39;: array([5.19285154])},
 &#39;rv&#39;: array([0.34277832]),
 &#39;rva&#39;: array([0.29773191]),
 &#39;input&#39;: {&#39;cf_y&#39;: 0.03,
  &#39;cf_d&#39;: 0.03,
  &#39;rho&#39;: 1.0,
  &#39;level&#39;: 0.95,
  &#39;null_hypothesis&#39;: array([0.])}}
</pre></div></div>
</div>
<p>The robustness value <span class="math notranslate nohighlight">\(RV\)</span> means that unobserved counfounders would have to account for <span class="math notranslate nohighlight">\(34\%\)</span> of the residual variation (in treatment and outcome) to explain away the treatment effect.</p>
<p>We can also consider a contour plot to consider different values of confounding <code class="docutils literal notranslate"><span class="pre">cf_y</span></code> and <code class="docutils literal notranslate"><span class="pre">cf_d</span></code>. The contour plot and robustness values are based on the upper or lower bounds based on the null hypothesis (in this case this results in the lower bound).</p>
<p>Remark that both, the robustness values and the contour plot use the prespecified value of <code class="docutils literal notranslate"><span class="pre">rho</span></code> and the <code class="docutils literal notranslate"><span class="pre">null_hypothesis</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_obj</span><span class="o">.</span><span class="n">sensitivity_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="admonition warning">
<p>Data type cannot be displayed: application/vnd.plotly.v1+json</p>
</div>
</div>
</div>
<p>To consider a different null hypothesis and add a different scenario to the the contour plot, we can adjust the parameter <code class="docutils literal notranslate"><span class="pre">null_hypothesis</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_obj</span><span class="o">.</span><span class="n">sensitivity_analysis</span><span class="p">(</span><span class="n">cf_y</span><span class="o">=</span><span class="n">cf_y</span><span class="p">,</span> <span class="n">cf_d</span><span class="o">=</span><span class="n">cf_d</span><span class="p">,</span> <span class="n">null_hypothesis</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_obj</span><span class="o">.</span><span class="n">sensitivity_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== Sensitivity Analysis ==================

------------------ Scenario          ------------------
Significance Level: level=0.95
Sensitivity parameters: cf_y=0.1; cf_d=0.1, rho=1.0

------------------ Bounds with CI    ------------------
   CI lower  theta lower     theta  theta upper  CI upper
d  2.396879     3.100324  4.129914     5.159504   5.96804

------------------ Robustness Values ------------------
   H_0    RV (%)  RVa (%)
d  5.0  8.520003  1.16567
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_obj</span><span class="o">.</span><span class="n">sensitivity_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="admonition warning">
<p>Data type cannot be displayed: application/vnd.plotly.v1+json</p>
</div>
</div>
</div>
</section>
</section>
<section id="Application:-401(k)">
<h2>Application: 401(k)<a class="headerlink" href="#Application:-401(k)" title="Permalink to this heading">#</a></h2>
<p>In this real-data example, we illustrate how to use the sensitivity analysis from the <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> package to evaluate effect estimates from 401(k) eligibility on accumulated assets. The 401(k) data set has been analyzed in several studies, among others <a class="reference external" href="https://arxiv.org/abs/1608.00060">Chernozhukov et al. (2018)</a>, see <a class="reference external" href="https://arxiv.org/abs/1912.12945">Kallus et al. (2019)</a> for quantile effects.</p>
<p><strong>Remark:</strong> This notebook focuses on sensitivity analysis. For a basic introduction to the <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> package and a detailed example of the average treatment effect estimation for the 401(k) data set, we refer to the notebook <a class="reference external" href="https://docs.doubleml.org/stable/examples/py_double_ml_pension.html">Python: Impact of 401(k) on Financial Wealth</a>.</p>
<section id="Data-and-Effect-Estimation">
<h3>Data and Effect Estimation<a class="headerlink" href="#Data-and-Effect-Estimation" title="Permalink to this heading">#</a></h3>
<p>Define eligiblity as treatment and the net financial assets as outcome to construct a DoubleML object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">fetch_401K</span><span class="p">(</span><span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;DataFrame&#39;</span><span class="p">)</span>

<span class="c1"># Set up basic model: Specify variables for data-backend</span>
<span class="n">features_base</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">,</span> <span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;fsize&#39;</span><span class="p">,</span> <span class="s1">&#39;marr&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;twoearn&#39;</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;pira&#39;</span><span class="p">,</span> <span class="s1">&#39;hown&#39;</span><span class="p">]</span>

<span class="c1"># Initialize DoubleMLData (data-backend of DoubleML)</span>
<span class="n">data_dml</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                            <span class="n">y_col</span><span class="o">=</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span>
                            <span class="n">d_cols</span><span class="o">=</span><span class="s1">&#39;e401&#39;</span><span class="p">,</span>
                            <span class="n">x_cols</span><span class="o">=</span><span class="n">features_base</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_dml</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== DoubleMLData Object ==================

------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): [&#39;e401&#39;]
Covariates: [&#39;age&#39;, &#39;inc&#39;, &#39;educ&#39;, &#39;fsize&#39;, &#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;, &#39;hown&#39;]
Instrument variable(s): None
No. Observations: 9915

------------------ DataFrame info    ------------------
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 9915 entries, 0 to 9914
Columns: 14 entries, nifa to hown
dtypes: float32(4), int8(10)
memory usage: 329.2 KB

</pre></div></div>
</div>
<p>Use basic random forests to estimate the nuisance elements and fit a <a class="reference external" href="https://docs.doubleml.org/stable/api/generated/doubleml.DoubleMLPLR.html">DoubleMLPLR</a> model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">learner_l</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">max_features</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">learner_m</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                   <span class="n">max_features</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">dml_plr_obj</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">data_dml</span><span class="p">,</span>
                              <span class="n">ml_l</span> <span class="o">=</span> <span class="n">learner_l</span><span class="p">,</span>
                              <span class="n">ml_m</span> <span class="o">=</span> <span class="n">learner_m</span><span class="p">,</span>
                              <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                              <span class="n">n_rep</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_plr_obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== DoubleMLPLR Object ==================

------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): [&#39;e401&#39;]
Covariates: [&#39;age&#39;, &#39;inc&#39;, &#39;educ&#39;, &#39;fsize&#39;, &#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;, &#39;hown&#39;]
Instrument variable(s): None
No. Observations: 9915

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
Learner ml_l: RandomForestRegressor(max_depth=10, max_features=5, min_samples_leaf=10,
                      n_estimators=500)
Learner ml_m: RandomForestClassifier(max_depth=10, max_features=5, min_samples_leaf=10,
                       n_estimators=500)
Out-of-sample Performance:
Learner ml_l RMSE: [[54163.99232145]
 [54716.48029755]
 [54378.6810775 ]]
Learner ml_m RMSE: [[0.44435333]
 [0.44408333]
 [0.44482929]]

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 3
Apply cross-fitting: True

------------------ Fit summary       ------------------
             coef      std err         t         P&gt;|t|        2.5 %  \
e401  8843.744236  1349.765864  6.552058  5.674949e-11  6198.251755

            97.5 %
e401  11489.236716
</pre></div></div>
</div>
</section>
<section id="id1">
<h3>Sensitivity Analysis<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>In their paper <a class="reference external" href="https://www.nber.org/papers/w30302">Chernozhukov et al. (2022)</a> argue that confounding should not account for more than <span class="math notranslate nohighlight">\(4\%\)</span> of the residual variation of the outcome and <span class="math notranslate nohighlight">\(3\%\)</span> of the residual variation of the treatment. Consequently, we set <code class="docutils literal notranslate"><span class="pre">cf_y=0.04</span></code> and <code class="docutils literal notranslate"><span class="pre">cf_d=0.03</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">sensitivity_analysis</span><span class="p">(</span><span class="n">cf_y</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">cf_d</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">sensitivity_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== Sensitivity Analysis ==================

------------------ Scenario          ------------------
Significance Level: level=0.95
Sensitivity parameters: cf_y=0.04; cf_d=0.03, rho=1.0

------------------ Bounds with CI    ------------------
         CI lower  theta lower        theta   theta upper     CI upper
e401  2258.287384  4567.712503  8843.744236  13119.775969  15375.33527

------------------ Robustness Values ------------------
      H_0    RV (%)   RVa (%)
e401  0.0  7.014681  5.162587
</pre></div></div>
</div>
<p>Our robustness values are similar to the ones in the paper. The effect estimate is robust in the sense that unobserved confounders (e.g. latent firm characteristics) would have to account for at least <span class="math notranslate nohighlight">\(7,1\%\)</span> of the residual variation (in the outcome and treatment) to reduce the lower bound on the effect to zero. Including estimation uncertainty unobserved confounders still have to explain <span class="math notranslate nohighlight">\(5.3\%\)</span> of the residual variation to render the effect estimate insignificant.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">sensitivity_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="admonition warning">
<p>Data type cannot be displayed: application/vnd.plotly.v1+json</p>
</div>
</div>
</div>
</section>
<section id="Benchmarking-Analysis">
<h3>Benchmarking Analysis<a class="headerlink" href="#Benchmarking-Analysis" title="Permalink to this heading">#</a></h3>
<p>Usually, it is quite hard to argue which strength of possible confounding <code class="docutils literal notranslate"><span class="pre">cf_y</span></code> and <code class="docutils literal notranslate"><span class="pre">cf_d</span></code> is reasonable. A common approach is to use observed confounders to get an informed guess on the strength of possible confounding.</p>
<p>This is implemented via the <code class="docutils literal notranslate"><span class="pre">sensitivity_benchmark()</span></code> method. For a more detailed description see <a class="reference external" href="https://docs.doubleml.org/stable/guide/guide.html">User Guide</a> or <a class="reference external" href="https://www.nber.org/papers/w30302">Chernozhukov et al. (2022)</a> Appendix D.</p>
<p>To benchmark the confounding values, one has to specify a set of observed confounders as <code class="docutils literal notranslate"><span class="pre">benchmarking_set</span></code>. The methods then returns a dataframe with the benchmarked values for <code class="docutils literal notranslate"><span class="pre">cf_y</span></code>,<code class="docutils literal notranslate"><span class="pre">cf_d</span></code>,<code class="docutils literal notranslate"><span class="pre">rho</span></code> and the change in the estimates if the <code class="docutils literal notranslate"><span class="pre">benchmarking_set</span></code> would be omitted from the set of confounders. To consider the confounding strength of multiple variables one has to repeat the benchmarking procedure for each variable separately (this might take some time as a seperate benchmark
model has to be fitted each repetion).</p>
<p>In this example, we will try to consider the same benchmarks as in <a class="reference external" href="https://www.nber.org/papers/w30302">Chernozhukov et al. (2022)</a> Appendix D. Therefore, we will take a look on the following variables: - income <code class="docutils literal notranslate"><span class="pre">inc</span></code> - participation individual retirement account <code class="docutils literal notranslate"><span class="pre">pira</span></code> - two-earner household <code class="docutils literal notranslate"><span class="pre">twoearn</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark_inc</span> <span class="o">=</span> <span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">sensitivity_benchmark</span><span class="p">(</span><span class="n">benchmarking_set</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">])</span>
<span class="n">benchmark_pira</span> <span class="o">=</span> <span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">sensitivity_benchmark</span><span class="p">(</span><span class="n">benchmarking_set</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pira&quot;</span><span class="p">])</span>
<span class="n">benchmark_twoearn</span> <span class="o">=</span> <span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">sensitivity_benchmark</span><span class="p">(</span><span class="n">benchmarking_set</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;twoearn&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">benchmark_inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">benchmark_pira</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">benchmark_twoearn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
         cf_y      cf_d       rho  delta_theta
e401  0.13956  0.046728  0.358395  3696.252253
         cf_y      cf_d       rho  delta_theta
e401  0.05039  0.002779  0.214764    338.70583
          cf_y      cf_d       rho  delta_theta
e401  0.011823  0.000743 -0.804284  -278.905951
</pre></div></div>
</div>
<p>We can add the scenario to the contour plot via a dictionary (remark that <code class="docutils literal notranslate"><span class="pre">rho</span></code> will be still based on the original value from <code class="docutils literal notranslate"><span class="pre">sensitivity_params</span></code> and can be manually adjusted by calling <code class="docutils literal notranslate"><span class="pre">sensitivity_analysis()</span></code> again).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cf_y&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="n">benchmark_inc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_y&quot;</span><span class="p">],</span> <span class="n">benchmark_pira</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_y&quot;</span><span class="p">],</span> <span class="n">benchmark_twoearn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_y&quot;</span><span class="p">]],</span>
                  <span class="s2">&quot;cf_d&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="n">benchmark_inc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_d&quot;</span><span class="p">],</span> <span class="n">benchmark_pira</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_d&quot;</span><span class="p">],</span> <span class="n">benchmark_twoearn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_d&quot;</span><span class="p">]],</span>
                  <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="s2">&quot;pira&quot;</span><span class="p">,</span> <span class="s2">&quot;twoearn&quot;</span><span class="p">]}</span>
<span class="n">dml_plr_obj</span><span class="o">.</span><span class="n">sensitivity_plot</span><span class="p">(</span><span class="n">benchmarks</span><span class="o">=</span><span class="n">benchmark_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="admonition warning">
<p>Data type cannot be displayed: application/vnd.plotly.v1+json</p>
</div>
</div>
</div>
</section>
<section id="Sensitivity-Analysis-with-IRM">
<h3>Sensitivity Analysis with IRM<a class="headerlink" href="#Sensitivity-Analysis-with-IRM" title="Permalink to this heading">#</a></h3>
<p>The sensitivity analysis with the IRM model is basically analogous.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">dml_irm_obj</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIRM</span><span class="p">(</span><span class="n">data_dml</span><span class="p">,</span>
                              <span class="n">ml_g</span> <span class="o">=</span> <span class="n">learner_l</span><span class="p">,</span>
                              <span class="n">ml_m</span> <span class="o">=</span> <span class="n">learner_m</span><span class="p">,</span>
                              <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                              <span class="n">n_rep</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dml_irm_obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== DoubleMLIRM Object ==================

------------------ Data summary      ------------------
Outcome variable: net_tfa
Treatment variable(s): [&#39;e401&#39;]
Covariates: [&#39;age&#39;, &#39;inc&#39;, &#39;educ&#39;, &#39;fsize&#39;, &#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;, &#39;hown&#39;]
Instrument variable(s): None
No. Observations: 9915

------------------ Score &amp; algorithm ------------------
Score function: ATE
DML algorithm: dml2

------------------ Machine learner   ------------------
Learner ml_g: RandomForestRegressor(max_depth=10, max_features=5, min_samples_leaf=10,
                      n_estimators=500)
Learner ml_m: RandomForestClassifier(max_depth=10, max_features=5, min_samples_leaf=10,
                       n_estimators=500)
Out-of-sample Performance:
Learner ml_g0 RMSE: [[47964.89054938]
 [48031.17950931]
 [48056.2230924 ]]
Learner ml_g1 RMSE: [[64578.69574046]
 [64948.47593887]
 [64942.4100582 ]]
Learner ml_m RMSE: [[0.44423363]
 [0.44417343]
 [0.44480927]]

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 3
Apply cross-fitting: True

------------------ Fit summary       ------------------
             coef      std err         t         P&gt;|t|        2.5 %  \
e401  7644.321859  1193.019637  6.407541  1.478856e-10  5306.046338

          97.5 %
e401  9982.59738
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">sensitivity_analysis</span><span class="p">(</span><span class="n">cf_y</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">cf_d</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">sensitivity_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================== Sensitivity Analysis ==================

------------------ Scenario          ------------------
Significance Level: level=0.95
Sensitivity parameters: cf_y=0.04; cf_d=0.03, rho=1.0

------------------ Bounds with CI    ------------------
         CI lower  theta lower        theta  theta upper      CI upper
e401  1157.954329  3413.151643  7644.321859  11988.20504  14181.084912

------------------ Robustness Values ------------------
      H_0    RV (%)   RVa (%)
e401  0.0  6.120864  4.265104
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">sensitivity_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="admonition warning">
<p>Data type cannot be displayed: application/vnd.plotly.v1+json</p>
</div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark_inc</span> <span class="o">=</span> <span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">sensitivity_benchmark</span><span class="p">(</span><span class="n">benchmarking_set</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">])</span>
<span class="n">benchmark_pira</span> <span class="o">=</span> <span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">sensitivity_benchmark</span><span class="p">(</span><span class="n">benchmarking_set</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pira&quot;</span><span class="p">])</span>
<span class="n">benchmark_twoearn</span> <span class="o">=</span> <span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">sensitivity_benchmark</span><span class="p">(</span><span class="n">benchmarking_set</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;twoearn&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">benchmark_inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">benchmark_pira</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">benchmark_twoearn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
          cf_y      cf_d       rho  delta_theta
e401  0.112817  0.055979  0.470884  4463.157033
          cf_y      cf_d       rho  delta_theta
e401  0.056603  0.188847  0.024217    274.96011
          cf_y      cf_d       rho  delta_theta
e401  0.012273  0.118475 -0.031603  -138.904153
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cf_y&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="n">benchmark_inc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_y&quot;</span><span class="p">],</span> <span class="n">benchmark_pira</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_y&quot;</span><span class="p">],</span> <span class="n">benchmark_twoearn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_y&quot;</span><span class="p">]],</span>
                  <span class="s2">&quot;cf_d&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="n">benchmark_inc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_d&quot;</span><span class="p">],</span> <span class="n">benchmark_pira</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_d&quot;</span><span class="p">],</span> <span class="n">benchmark_twoearn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="s2">&quot;cf_d&quot;</span><span class="p">]],</span>
                  <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="s2">&quot;pira&quot;</span><span class="p">,</span> <span class="s2">&quot;twoearn&quot;</span><span class="p">]}</span>
<span class="n">dml_irm_obj</span><span class="o">.</span><span class="n">sensitivity_plot</span><span class="p">(</span><span class="n">benchmarks</span><span class="o">=</span><span class="n">benchmark_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="admonition warning">
<p>Data type cannot be displayed: application/vnd.plotly.v1+json</p>
</div>
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="py_double_ml_learner.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Python: Choice of learners</p>
      </div>
    </a>
    <a class="right-next"
       href="py_double_ml_policy_tree.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Python: Policy Learning with Trees</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Simulation-Example">Simulation Example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Data">Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#DoubleML-Object">DoubleML Object</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Sensitivity-Analysis">Sensitivity Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Application:-401(k)">Application: 401(k)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Data-and-Effect-Estimation">Data and Effect Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Sensitivity Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Benchmarking-Analysis">Benchmarking Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Sensitivity-Analysis-with-IRM">Sensitivity Analysis with IRM</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/examples/py_double_ml_sensitivity.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Bach, P., Chernozhukov, V., Klaassen, S., Kurz, M. S., and Spindler, M..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>