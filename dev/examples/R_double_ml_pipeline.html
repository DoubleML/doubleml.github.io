
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>R: Ensemble Learners and More with mlr3pipelines &#8212; DoubleML  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DML: Bonus Data" href="double_ml_bonus_data.html" />
    <link rel="prev" title="Python: Cluster Robust Double Machine Learning" href="py_double_ml_multiway_cluster.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">DoubleML  documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  DoubleML
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../intro/install.html">
  Install
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../intro/intro.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../guide/guide.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../workflow/workflow.html">
  Workflow
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api.html">
  Python API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://docs.doubleml.org/r/stable/">
  R API
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../literature/literature.html">
  Literature
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../release/release.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/DoubleML/doubleml-for-py" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><p class="logo" style="text-align:center;"><a href="../index.html">
    <img class="logo" src="../logo.png" alt="Logo" width="65%" height="65%">
</a></p><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="R_double_ml_pension.html">
   R: Impact of 401(k) on Financial Wealth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="r_double_ml_multiway_cluster.html">
   R: Cluster Robust Double Machine Learning
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="py_double_ml_pension.html">
   Python: Impact of 401(k) on Financial Wealth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="py_double_ml_multiway_cluster.html">
   Python: Cluster Robust Double Machine Learning
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   R: Ensemble Learners and More with
   <code class="docutils literal notranslate">
    <span class="pre">
     mlr3pipelines
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="double_ml_bonus_data.html">
   DML: Bonus Data
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Using-learners-from-mlr3,-mlr3learners-and-mlr3extralearners">
   Using learners from
   <code class="docutils literal notranslate">
    <span class="pre">
     mlr3
    </span>
   </code>
   ,
   <code class="docutils literal notranslate">
    <span class="pre">
     mlr3learners
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     mlr3extralearners
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Set-up-learners-based-on-mlr3pipelines">
   Set up learners based on
   <code class="docutils literal notranslate">
    <span class="pre">
     mlr3pipelines
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Use-ensemble-learners-based-on-mlr3pipelines">
   Use ensemble learners based on
   <code class="docutils literal notranslate">
    <span class="pre">
     mlr3pipelines
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#How-to-exploit-more-features-of-mlr3pipelines-in-DoubleML">
   How to exploit more features of
   <code class="docutils literal notranslate">
    <span class="pre">
     mlr3pipelines
    </span>
   </code>
   in
   <code class="docutils literal notranslate">
    <span class="pre">
     DoubleML
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Data-preprocessing">
     Data preprocessing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Parameter-tuning">
     Parameter tuning
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#References">
   References
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
    <div class="admonition note">
    <p class="admonition-title">Note</p>
    <ul class="simple">

Download Jupyter notebook:
<a class="reference external" href="https://docs.doubleml.org/stable/examples/R_double_ml_pipeline.ipynb">https://docs.doubleml.org/stable/examples/R_double_ml_pipeline.ipynb</a>.

    </ul>
    </div><section id="R:-Ensemble-Learners-and-More-with-mlr3pipelines">
<h1>R: Ensemble Learners and More with <code class="docutils literal notranslate"><span class="pre">mlr3pipelines</span></code><a class="headerlink" href="#R:-Ensemble-Learners-and-More-with-mlr3pipelines" title="Permalink to this heading">#</a></h1>
<p>This notebook illustrates how to exploit the powerful tools provided by the <a class="reference external" href="https://mlr3pipelines.mlr-org.com/">mlr3pipelines</a> package (Binder et al. 2021). For example, <a class="reference external" href="https://mlr3pipelines.mlr-org.com/">mlr3pipelines</a> can be used in combination with <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> for feature engineering, combination of learners (ensemble learners, stacking), subsampling and hyperparameter tuning. The underlying idea of
<a class="reference external" href="https://mlr3pipelines.mlr-org.com/">mlr3pipelines</a> is to define a pipeline that incorporates a user’s desired operations. As a result, the pipeline returns an object of class <a class="reference external" href="https://mlr3.mlr-org.com/reference/Learner.html">Learner</a> which can easily be passed to <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a>. For an introduction to <a class="reference external" href="https://mlr3pipelines.mlr-org.com/">mlr3pipelines</a>, we refer to the <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html">Pipelines Chapter</a> in the
<a class="reference external" href="https://mlr3book.mlr-org.com">mlr3book</a> (Becker et al. 2020) and to the <a class="reference external" href="https://mlr3pipelines.mlr-org.com/">package website</a>.</p>
<p>We intend to illustrate the major idea of how to use <a class="reference external" href="https://mlr3pipelines.mlr-org.com/">mlr3pipelines</a> in combination with <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> in very simple examples. We use pipelines that are identical or very similar to the ones in the <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html">Pipelines Chapter</a> in the <a class="reference external" href="https://mlr3book.mlr-org.com">mlr3book</a>. Hence, we do not claim that the proposed learners are optimal in terms of their performance.</p>
<p>We start with the simple simulated data example and the <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/fetch_bonus.html">Bonus data set</a> from the <a class="reference external" href="https://docs.doubleml.org/dev/intro/intro.html">Getting Started Section in the DoubleML user guide</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">DoubleML</span><span class="p">)</span>

<span class="c1"># Simulate data</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">3141</span><span class="p">)</span>
<span class="n">n_obs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span>
<span class="n">n_vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
<span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
<span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n_obs</span><span class="o">*</span><span class="n">n_vars</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="n">n_obs</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="n">n_vars</span><span class="p">)</span>
<span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="o">%*%</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n_obs</span><span class="p">)</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theta</span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">X</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="o">%*%</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n_obs</span><span class="p">)</span>


<span class="c1"># Specify the data and variables for the causal model</span>
<span class="c1"># matrix interface to DoubleMLData</span>
<span class="n">dml_data_sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">double_ml_data_from_matrix</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
<span class="n">dml_data_sim</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: y
Treatment variable(s): d
Covariates: X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, X16, X17, X18, X19, X20, X21, X22, X23, X24, X25, X26, X27, X28, X29, X30, X31, X32, X33, X34, X35, X36, X37, X38, X39, X40, X41, X42, X43, X44, X45, X46, X47, X48, X49, X50, X51, X52, X53, X54, X55, X56, X57, X58, X59, X60, X61, X62, X63, X64, X65, X66, X67, X68, X69, X70, X71, X72, X73, X74, X75, X76, X77, X78, X79, X80, X81, X82, X83, X84, X85, X86, X87, X88, X89, X90, X91, X92, X93, X94, X95, X96, X97, X98, X99, X100
Instrument(s):
No. Observations: 500
</pre></div></div>
</div>
<p>To have an example with a classification learner, we load the <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/fetch_bonus.html">Bonus data set</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load bonus data</span>
<span class="n">df_bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fetch_bonus</span><span class="p">(</span><span class="n">return_type</span><span class="o">=</span><span class="s">&quot;data.table&quot;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">df_bonus</span><span class="p">)</span>

<span class="c1"># Specify the data and variables for the causal model</span>
<span class="n">x_vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;female&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;othrace&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dep1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dep2&quot;</span><span class="p">,</span>
<span class="w">           </span><span class="s">&quot;q2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;q3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;q4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;q5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;q6&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;agelt35&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;agegt54&quot;</span><span class="p">,</span>
<span class="w">           </span><span class="s">&quot;durable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lusd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;husd&quot;</span><span class="p">)</span>
<span class="n">dim_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x_vars</span><span class="p">)</span>
<span class="n">dml_data_bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLData</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">df_bonus</span><span class="p">,</span>
<span class="w">                             </span><span class="n">y_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;inuidur1&quot;</span><span class="p">,</span>
<span class="w">                             </span><span class="n">d_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tg&quot;</span><span class="p">,</span>
<span class="w">                             </span><span class="n">x_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_vars</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">dml_data_bonus</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table class="dataframe">
<caption>A data.table: 6 × 17</caption>
<thead>
    <tr><th scope=col>inuidur1</th><th scope=col>female</th><th scope=col>black</th><th scope=col>othrace</th><th scope=col>dep1</th><th scope=col>dep2</th><th scope=col>q2</th><th scope=col>q3</th><th scope=col>q4</th><th scope=col>q5</th><th scope=col>q6</th><th scope=col>agelt35</th><th scope=col>agegt54</th><th scope=col>durable</th><th scope=col>lusd</th><th scope=col>husd</th><th scope=col>tg</th></tr>
    <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2.890372</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
    <tr><td>0.000000</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><td>3.295837</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><td>2.197225</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
    <tr><td>3.295837</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><td>3.295837</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td></tr>
</tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLData Object ==================


------------------ Data summary      ------------------
Outcome variable: inuidur1
Treatment variable(s): tg
Covariates: female, black, othrace, dep1, dep2, q2, q3, q4, q5, q6, agelt35, agegt54, durable, lusd, husd
Instrument(s):
No. Observations: 5099
</pre></div></div>
</div>
<p>To specify a learner for the nuisance part in a causal model, we can either use <a class="reference external" href="https://mlr3.mlr-org.com/">mlr3</a>’s <a class="reference external" href="https://mlr3.mlr-org.com/reference/LearnerRegr.html">LearnerRegr</a> for a model’s nuisance part with a continuous dependent variable or a <a class="reference external" href="https://mlr3.mlr-org.com/reference/LearnerClassif.html">LearnerClassif</a> if the corresponding outcome variable is binary.</p>
<p>Moreover, it’s possible to create a learner based on a pipeline. For example, we could think of <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html#pipe-model-ensembles">ensemble learners</a> which combine several estimators.</p>
<section id="Using-learners-from-mlr3,-mlr3learners-and-mlr3extralearners">
<h2>Using learners from <code class="docutils literal notranslate"><span class="pre">mlr3</span></code>, <code class="docutils literal notranslate"><span class="pre">mlr3learners</span></code> and <code class="docutils literal notranslate"><span class="pre">mlr3extralearners</span></code><a class="headerlink" href="#Using-learners-from-mlr3,-mlr3learners-and-mlr3extralearners" title="Permalink to this heading">#</a></h2>
<p>Let’s begin with a “standard” example on how to use any of the learners provided by <a class="reference external" href="https://mlr3.mlr-org.com/">mlr3</a> (Lang et al. 2020), <a class="reference external" href="https://mlr3learners.mlr-org.com/">mlr3learners</a> (Lang et al. 2021) and <a class="reference external" href="https://mlr3extralearners.mlr-org.com/">mlr3extralearners</a> (Sonabend and Schratz 2021) in <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a>: We create an object of the class <a class="reference external" href="https://mlr3.mlr-org.com/reference/Learner.html">Learner</a> which
<a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> internally uses for model training and generation of predictions.</p>
<p>In the simulated example, we will use a lasso estimator for the continuous treatment variable, which is based on the <a class="reference external" href="https://glmnet.stanford.edu/index.html">glmnet package</a>. For the binary treatment variable in the Bonus data example, we use a random forest classifier as provided by <a class="reference external" href="https://github.com/imbs-hl/ranger">ranger</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">mlr3</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">mlr3learners</span><span class="p">)</span>

<span class="c1"># suppress messages during fitting</span>
<span class="n">lgr</span><span class="o">::</span><span class="nf">get_logger</span><span class="p">(</span><span class="s">&quot;mlr3&quot;</span><span class="p">)</span><span class="o">$</span><span class="nf">set_threshold</span><span class="p">(</span><span class="s">&quot;warn&quot;</span><span class="p">)</span>

<span class="n">learner_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.cv_glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="s">&quot;lambda.min&quot;</span><span class="p">)</span>
<span class="n">ml_l_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">learner_lasso</span><span class="o">$</span><span class="nf">clone</span><span class="p">()</span>
<span class="n">ml_m_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">learner_lasso</span><span class="o">$</span><span class="nf">clone</span><span class="p">()</span>
<span class="nf">class</span><span class="p">(</span><span class="n">ml_l_lasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'LearnerRegrCVGlmnet'</li><li>'LearnerRegr'</li><li>'Learner'</li><li>'R6'</li></ol></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random forest learner for nuisance part ml_l</span>
<span class="n">learner_forest_regr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.ranger&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="n">num.trees</span><span class="o">=</span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="o">=</span><span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)),</span>
<span class="w">                          </span><span class="n">max.depth</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># Random forest learner for nuisance part ml_m (binary outcome)</span>
<span class="n">learner_forest_classif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.ranger&quot;</span><span class="p">,</span>
<span class="w">                             </span><span class="n">num.trees</span><span class="o">=</span><span class="m">500</span><span class="p">,</span>
<span class="w">                             </span><span class="n">mtry</span><span class="o">=</span><span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)),</span>
<span class="w">                             </span><span class="n">max.depth</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="n">ml_l_forest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">learner_forest_regr</span><span class="o">$</span><span class="nf">clone</span><span class="p">()</span>
<span class="n">ml_m_forest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">learner_forest_classif</span><span class="o">$</span><span class="nf">clone</span><span class="p">()</span>
<span class="nf">class</span><span class="p">(</span><span class="n">ml_l_forest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'LearnerRegrRanger'</li><li>'LearnerRegr'</li><li>'Learner'</li><li>'R6'</li></ol></div>
</div>
<p>We set up a causal model, here we specify a partially linear model and thereby pass the learner as an input. Let’s fit the models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_sim</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">ml_l</span><span class="o">=</span><span class="n">ml_l_lasso</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">ml_m</span><span class="o">=</span><span class="n">ml_m_lasso</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_sim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: y
Treatment variable(s): d
Covariates: X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, X16, X17, X18, X19, X20, X21, X22, X23, X24, X25, X26, X27, X28, X29, X30, X31, X32, X33, X34, X35, X36, X37, X38, X39, X40, X41, X42, X43, X44, X45, X46, X47, X48, X49, X50, X51, X52, X53, X54, X55, X56, X57, X58, X59, X60, X61, X62, X63, X64, X65, X66, X67, X68, X69, X70, X71, X72, X73, X74, X75, X76, X77, X78, X79, X80, X81, X82, X83, X84, X85, X86, X87, X88, X89, X90, X91, X92, X93, X94, X95, X96, X97, X98, X99, X100
Instrument(s):
No. Observations: 500

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.cv_glmnet
ml_m: regr.cv_glmnet

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
  Estimate. Std. Error t value Pr(&gt;|t|)
d   3.01219    0.04415   68.22   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_bonus</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ml_l</span><span class="o">=</span><span class="n">ml_l_forest</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ml_m</span><span class="o">=</span><span class="n">ml_m_forest</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_bonus</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: inuidur1
Treatment variable(s): tg
Covariates: female, black, othrace, dep1, dep2, q2, q3, q4, q5, q6, agelt35, agegt54, durable, lusd, husd
Instrument(s):
No. Observations: 5099

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.ranger
ml_m: classif.ranger

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
   Estimate. Std. Error t value Pr(&gt;|t|)
tg   -0.0765     0.0354  -2.161   0.0307 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
</section>
<section id="Set-up-learners-based-on-mlr3pipelines">
<h2>Set up learners based on <code class="docutils literal notranslate"><span class="pre">mlr3pipelines</span></code><a class="headerlink" href="#Set-up-learners-based-on-mlr3pipelines" title="Permalink to this heading">#</a></h2>
<p>These learners can also be constructed using <a class="reference external" href="https://mlr3pipelines.mlr-org.com/">mlr3pipelines</a>. We’ll first use the PipeOp constructor <a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/po.html">po()</a> to define the learner construction and then initiate a new instance of the <a class="reference external" href="https://mlr3.mlr-org.com/reference/Learner.html">Learner</a> class. <a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/po.html">po()</a> implements a computational step in a pipeline. For more information, we refer to the
<a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html">Pipelines Chapter in the mlr3book</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso learner</span>
<span class="nf">library</span><span class="p">(</span><span class="n">mlr3pipelines</span><span class="p">)</span>
<span class="n">pipe_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.cv_glmnet&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lambda.min&quot;</span><span class="p">)</span>
<span class="n">ml_l_lasso_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">pipe_lasso</span><span class="p">)</span>
<span class="n">ml_m_lasso_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">pipe_lasso</span><span class="p">)</span>

<span class="c1"># Class of the lasso learner</span>
<span class="nf">class</span><span class="p">(</span><span class="n">ml_l_lasso_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'GraphLearner'</li><li>'Learner'</li><li>'R6'</li></ol></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random forest learner for nuisance part ml_l</span>
<span class="n">pipe_forest_regr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.ranger&quot;</span><span class="p">),</span>
<span class="w">                      </span><span class="n">num.trees</span><span class="o">=</span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="o">=</span><span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)),</span>
<span class="w">                      </span><span class="n">max.depth</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># Random forest learner for nuisance part ml_m (binary outcome)</span>
<span class="n">pipe_forest_classif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.ranger&quot;</span><span class="p">),</span>
<span class="w">                             </span><span class="n">num.trees</span><span class="o">=</span><span class="m">500</span><span class="p">,</span>
<span class="w">                             </span><span class="n">mtry</span><span class="o">=</span><span class="nf">floor</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)),</span>
<span class="w">                             </span><span class="n">max.depth</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">min.node.size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="n">ml_l_forest_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">pipe_forest_regr</span><span class="p">)</span>
<span class="n">ml_m_forest_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">pipe_forest_classif</span><span class="p">)</span>

<span class="c1"># Class of the random forest learners</span>
<span class="nf">class</span><span class="p">(</span><span class="n">ml_l_forest_pipe</span><span class="p">)</span>
<span class="nf">class</span><span class="p">(</span><span class="n">ml_m_forest_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'GraphLearner'</li><li>'Learner'</li><li>'R6'</li></ol></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'GraphLearner'</li><li>'Learner'</li><li>'R6'</li></ol></div>
</div>
<p>Let’s use these learners to fit the PLR in both examples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_sim</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">ml_l</span><span class="o">=</span><span class="n">ml_l_lasso_pipe</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">ml_m</span><span class="o">=</span><span class="n">ml_m_lasso_pipe</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim_pipe</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_sim_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: y
Treatment variable(s): d
Covariates: X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, X16, X17, X18, X19, X20, X21, X22, X23, X24, X25, X26, X27, X28, X29, X30, X31, X32, X33, X34, X35, X36, X37, X38, X39, X40, X41, X42, X43, X44, X45, X46, X47, X48, X49, X50, X51, X52, X53, X54, X55, X56, X57, X58, X59, X60, X61, X62, X63, X64, X65, X66, X67, X68, X69, X70, X71, X72, X73, X74, X75, X76, X77, X78, X79, X80, X81, X82, X83, X84, X85, X86, X87, X88, X89, X90, X91, X92, X93, X94, X95, X96, X97, X98, X99, X100
Instrument(s):
No. Observations: 500

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.cv_glmnet
ml_m: regr.cv_glmnet

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
  Estimate. Std. Error t value Pr(&gt;|t|)
d   3.01219    0.04415   68.22   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_bonus</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ml_l</span><span class="o">=</span><span class="n">ml_l_forest_pipe</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ml_m</span><span class="o">=</span><span class="n">ml_m_forest_pipe</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_bonus_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: inuidur1
Treatment variable(s): tg
Covariates: female, black, othrace, dep1, dep2, q2, q3, q4, q5, q6, agelt35, agegt54, durable, lusd, husd
Instrument(s):
No. Observations: 5099

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.ranger
ml_m: classif.ranger

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
   Estimate. Std. Error t value Pr(&gt;|t|)
tg   -0.0765     0.0354  -2.161   0.0307 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
</section>
<section id="Use-ensemble-learners-based-on-mlr3pipelines">
<h2>Use ensemble learners based on <code class="docutils literal notranslate"><span class="pre">mlr3pipelines</span></code><a class="headerlink" href="#Use-ensemble-learners-based-on-mlr3pipelines" title="Permalink to this heading">#</a></h2>
<p>First, let’s see how we can use more complicated <a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html">GraphLearner</a>s like ensemble learners in <a class="reference external" href="https://docs.doubleml.org/">DoubleML</a>. For example, we want to create a learner with predictions that are generated as an average from three different learners. In the first step, we split up the pipeline into three branches. In our example, the learners estimate the nuisance parts independently of each other. In the last step,
we average the predictions. Thereby we will use the pipe operator <code class="docutils literal notranslate"><span class="pre">%&gt;&gt;%</span></code>. For more details, we refer to the <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html">Pipelines Chapter in the mlr3book</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># For regression (nuisance parts with continuous outcome)</span>
<span class="n">graph_ensemble_regr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">gunion</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.cv_glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lambda.min&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.ranger&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.rpart&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">))</span>
<span class="w">  </span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;&gt;%</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;regravg&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="c1"># Class of &#39; graph_ensemble_regr&#39;</span>
<span class="nf">class</span><span class="p">(</span><span class="n">graph_ensemble_regr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Graph'</li><li>'R6'</li></ol></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the graph</span>
<span class="n">graph_ensemble_regr</span><span class="o">$</span><span class="nf">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pipeline_22_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pipeline_22_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># For classification (nuisance part ml_m in the Bonus example)</span>
<span class="n">graph_ensemble_classif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">gunion</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.cv_glmnet&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lambda.min&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.ranger&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">))</span>
<span class="w">  </span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;&gt;%</span>
<span class="w">    </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;classifavg&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="c1"># Class of &#39;graph_ensemble_classif&#39;</span>
<span class="nf">class</span><span class="p">(</span><span class="n">graph_ensemble_classif</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Graph'</li><li>'R6'</li></ol></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the graph</span>
<span class="n">graph_ensemble_classif</span><span class="o">$</span><span class="nf">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pipeline_24_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pipeline_24_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
<p>We create a new instance of a <a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html">GraphLearner</a> which is later used in <a class="reference external" href="https://docs.doubleml.org">DoubleML</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">ensemble_pipe_regr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">graph_ensemble_regr</span><span class="p">)</span>
<span class="n">ensemble_pipe_classif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">graph_ensemble_classif</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s estimate the two PLR examples with the ensemble learner.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initiate new DoubleML object and estimate with graph learner</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim_pipe_ensemble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_sim</span><span class="p">,</span>
<span class="w">                                                </span><span class="n">ml_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ensemble_pipe_regr</span><span class="p">,</span>
<span class="w">                                                </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ensemble_pipe_regr</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim_pipe_ensemble</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_sim_pipe_ensemble</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: y
Treatment variable(s): d
Covariates: X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, X16, X17, X18, X19, X20, X21, X22, X23, X24, X25, X26, X27, X28, X29, X30, X31, X32, X33, X34, X35, X36, X37, X38, X39, X40, X41, X42, X43, X44, X45, X46, X47, X48, X49, X50, X51, X52, X53, X54, X55, X56, X57, X58, X59, X60, X61, X62, X63, X64, X65, X66, X67, X68, X69, X70, X71, X72, X73, X74, X75, X76, X77, X78, X79, X80, X81, X82, X83, X84, X85, X86, X87, X88, X89, X90, X91, X92, X93, X94, X95, X96, X97, X98, X99, X100
Instrument(s):
No. Observations: 500

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.cv_glmnet.regr.ranger.regr.rpart.regravg
ml_m: regr.cv_glmnet.regr.ranger.regr.rpart.regravg

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
  Estimate. Std. Error t value Pr(&gt;|t|)
d   3.88664    0.02584   150.4   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe_ensemble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_bonus</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ml_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ensemble_pipe_regr</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ml_m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ensemble_pipe_classif</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe_ensemble</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_bonus_pipe_ensemble</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: inuidur1
Treatment variable(s): tg
Covariates: female, black, othrace, dep1, dep2, q2, q3, q4, q5, q6, agelt35, agegt54, durable, lusd, husd
Instrument(s):
No. Observations: 5099

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.cv_glmnet.regr.ranger.regr.rpart.regravg
ml_m: classif.cv_glmnet.classif.ranger.classif.rpart.classifavg

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
   Estimate. Std. Error t value Pr(&gt;|t|)
tg  -0.07689    0.03545  -2.169   0.0301 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
<p>Alternatively, different learners could also be stacked. Here we simply repeat the example from the <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html#pipe-model-ensembles-stacking">Pipelines Chapter in the mlr3book</a> in our Bonus data example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lrn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">)</span>
<span class="n">lrn_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner_cv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lrn</span><span class="o">$</span><span class="nf">clone</span><span class="p">())</span>
<span class="n">lrn_0</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rpart_cv&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pass original features to final estimation step</span>
<span class="n">level_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">gunion</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">lrn_0</span><span class="p">,</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;nop&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">combined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">level_0</span><span class="w"> </span><span class="o">%&gt;&gt;%</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;featureunion&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combined</span><span class="w"> </span><span class="o">%&gt;&gt;%</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lrn</span><span class="o">$</span><span class="nf">clone</span><span class="p">())</span>
<span class="n">stack</span><span class="o">$</span><span class="nf">plot</span><span class="p">(</span><span class="n">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pipeline_34_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pipeline_34_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a stacked learner and pass it to a DoubleML object</span>
<span class="n">stacklrn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_bonus</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">ml_l</span><span class="o">=</span><span class="n">ml_l_forest</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">ml_m</span><span class="o">=</span><span class="n">stacklrn</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_bonus_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: inuidur1
Treatment variable(s): tg
Covariates: female, black, othrace, dep1, dep2, q2, q3, q4, q5, q6, agelt35, agegt54, durable, lusd, husd
Instrument(s):
No. Observations: 5099

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.ranger
ml_m: rpart_cv.nop.featureunion.classif.rpart

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
   Estimate. Std. Error t value Pr(&gt;|t|)
tg  -0.07915    0.03538  -2.237   0.0253 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
</section>
<section id="How-to-exploit-more-features-of-mlr3pipelines-in-DoubleML">
<h2>How to exploit more features of <code class="docutils literal notranslate"><span class="pre">mlr3pipelines</span></code> in <code class="docutils literal notranslate"><span class="pre">DoubleML</span></code><a class="headerlink" href="#How-to-exploit-more-features-of-mlr3pipelines-in-DoubleML" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/Graph.html">mlr3pipelines</a> can do much more. For example, we could use it to perform some <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html#pipe-modeling">feature engineering</a> and even perform pipeline-based <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html#pipe-tuning">parameter tuning</a>. We just have to define the steps we want to have in our pipeline by using the PipeOps.</p>
<p>Let’s have a look at two more examples from the <a class="reference external" href="https://mlr3book.mlr-org.com/pipelines.html">Pipelines Chapter in the mlr3book</a>. In the first one, we will do some data manipulation. The second example illustrate how we could use <a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/Graph.html">mlr3pipelines</a> for parameter tuning.</p>
<section id="Data-preprocessing">
<h3>Data preprocessing<a class="headerlink" href="#Data-preprocessing" title="Permalink to this heading">#</a></h3>
<p>Let’s perform some data preprocessing and then use a regression tree for prediction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mutate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;mutate&quot;</span><span class="p">)</span>
<span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;filter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlr3filters</span><span class="o">::</span><span class="nf">flt</span><span class="p">(</span><span class="s">&quot;variance&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">param_vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">filter.frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Collect them in a graph and plot it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutate</span><span class="w"> </span><span class="o">%&gt;&gt;%</span>
<span class="w">  </span><span class="n">filter</span><span class="w"> </span><span class="o">%&gt;&gt;%</span>
<span class="w">  </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">learner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;classif.rpart&quot;</span><span class="p">))</span>

<span class="nf">class</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Graph'</li><li>'R6'</li></ol></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">$</span><span class="nf">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_R_double_ml_pipeline_41_0.png" class="no-scaled-link" src="../_images/examples_R_double_ml_pipeline_41_0.png" style="width: 420px; height: 420px;" />
</div>
</div>
<p>Create a new learner.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">glrn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">glrn</span>
<span class="nf">class</span><span class="p">(</span><span class="n">glrn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;GraphLearner:mutate.variance.classif.rpart&gt;
* Model: -
* Parameters: mutate.mutation=&lt;list&gt;, mutate.delete_originals=FALSE,
  variance.filter.frac=0.5, classif.rpart.xval=0
* Packages: mlr3, mlr3pipelines, rpart
* Predict Types:  [response], prob
* Feature Types: logical, integer, numeric, character, factor, ordered,
  POSIXct
* Properties: featureless, hotstart_backward, hotstart_forward,
  importance, loglik, missings, multiclass, oob_error,
  selected_features, twoclass, weights
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'GraphLearner'</li><li>'Learner'</li><li>'R6'</li></ol></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_bonus</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">ml_l</span><span class="o">=</span><span class="n">ml_l_lasso</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">ml_m</span><span class="o">=</span><span class="n">glrn</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe2</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_bonus_pipe2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: inuidur1
Treatment variable(s): tg
Covariates: female, black, othrace, dep1, dep2, q2, q3, q4, q5, q6, agelt35, agegt54, durable, lusd, husd
Instrument(s):
No. Observations: 5099

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.cv_glmnet
ml_m: mutate.variance.classif.rpart

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
   Estimate. Std. Error t value Pr(&gt;|t|)
tg  -0.07366    0.03539  -2.081   0.0374 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
<p>Let’s see how to set hyperparameters with a pipeline.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">glrn</span><span class="o">$</span><span class="n">param_set</span><span class="o">$</span><span class="n">values</span><span class="o">$</span><span class="n">variance.filter.frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_bonus</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">ml_l</span><span class="o">=</span><span class="n">ml_l_lasso</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">ml_m</span><span class="o">=</span><span class="n">glrn</span><span class="p">)</span>
<span class="n">obj_dml_plr_bonus_pipe3</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_bonus_pipe3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: inuidur1
Treatment variable(s): tg
Covariates: female, black, othrace, dep1, dep2, q2, q3, q4, q5, q6, agelt35, agegt54, durable, lusd, husd
Instrument(s):
No. Observations: 5099

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.cv_glmnet
ml_m: mutate.variance.classif.rpart

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
   Estimate. Std. Error t value Pr(&gt;|t|)
tg  -0.07366    0.03539  -2.081   0.0374 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
</section>
<section id="Parameter-tuning">
<h3>Parameter tuning<a class="headerlink" href="#Parameter-tuning" title="Permalink to this heading">#</a></h3>
<p>Next, we will shortly illustrate how to perform parameter tuning in the simulated data example. Here, we use a pipeline to tune the penalty of the lasso. To do so, we generate a <a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html">GraphLearner</a> and then call <a class="reference external" href="https://docs.doubleml.org">DoubleML</a>’s <a class="reference external" href="https://docs.doubleml.org/r/stable/reference/DoubleML.html#method-tune-">tune()</a> method.</p>
<p>Let’s define a <a class="reference external" href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html">GraphLearner</a> based on the lasso.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lasso_pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutate</span><span class="w"> </span><span class="o">%&gt;&gt;%</span>
<span class="w">  </span><span class="n">filter</span><span class="w"> </span><span class="o">%&gt;&gt;%</span>
<span class="w">  </span><span class="nf">po</span><span class="p">(</span><span class="s">&quot;learner&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">learner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lrn</span><span class="p">(</span><span class="s">&quot;regr.glmnet&quot;</span><span class="p">))</span>
<span class="n">glrn_lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_learner</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s specify the parameter grid and more settings that are required for the parameter tuning. For more details, we refer to <a class="reference external" href="https://docs.doubleml.org/stable/guide/learners.html#r-learners-and-hyperparameters">the DoubleML user guide</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameter grid for lambda and for optimal variance filter fraction</span>
<span class="nf">library</span><span class="p">(</span><span class="n">paradox</span><span class="p">)</span>
<span class="n">par_grids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ps</span><span class="p">(</span><span class="n">regr.glmnet.lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">p_dbl</span><span class="p">(</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">),</span>
<span class="w">               </span><span class="n">variance.filter.frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">p_dbl</span><span class="p">(</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify further tune settings</span>
<span class="nf">library</span><span class="p">(</span><span class="n">mlr3tuning</span><span class="p">)</span>
<span class="n">tune_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">terminator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">trm</span><span class="p">(</span><span class="s">&quot;evals&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n_evals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">),</span>
<span class="w">                      </span><span class="n">algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">tnr</span><span class="p">(</span><span class="s">&quot;grid_search&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">resolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">),</span>
<span class="w">                      </span><span class="n">rsmp_tune</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rsmp</span><span class="p">(</span><span class="s">&quot;cv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">folds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">),</span>
<span class="w">                      </span><span class="n">measure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s">&quot;ml_l&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">msr</span><span class="p">(</span><span class="s">&quot;regr.mse&quot;</span><span class="p">),</span>
<span class="w">                                     </span><span class="s">&quot;ml_m&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">msr</span><span class="p">(</span><span class="s">&quot;regr.mse&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initiate new DoubleML object and execute tuning with graph learner</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim_pipe_tune</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleMLPLR</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span><span class="n">dml_data_sim</span><span class="p">,</span>
<span class="w">                                            </span><span class="n">ml_l</span><span class="o">=</span><span class="n">glrn_lasso</span><span class="p">,</span>
<span class="w">                                            </span><span class="n">ml_m</span><span class="o">=</span><span class="n">glrn_lasso</span><span class="p">)</span>
<span class="n">obj_dml_plr_sim_pipe_tune</span><span class="o">$</span><span class="nf">tune</span><span class="p">(</span><span class="n">param_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s">&quot;ml_l&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par_grids</span><span class="p">,</span>
<span class="w">                                                </span><span class="s">&quot;ml_m&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par_grids</span><span class="p">),</span>
<span class="w">                               </span><span class="n">tune_settings</span><span class="o">=</span><span class="n">tune_settings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
INFO  [09:02:25.400] [bbotk] Starting to optimize 2 parameter(s) with &#39;&lt;TunerGridSearch&gt;&#39; and &#39;&lt;TerminatorEvals&gt; [n_evals=10, k=0]&#39;
INFO  [09:02:25.437] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:26.131] [bbotk] Result of batch 1:
INFO  [09:02:26.135] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:26.135] [bbotk]          0.07222222            0.6666667 107.2925        0      0
INFO  [09:02:26.135] [bbotk]  runtime_learners                                uhash
INFO  [09:02:26.135] [bbotk]             0.526 e44d2c68-dbdb-437a-8a3e-ea673f7bc943
INFO  [09:02:26.137] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:26.816] [bbotk] Result of batch 2:
INFO  [09:02:26.819] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:26.819] [bbotk]                 0.1            0.6666667 106.2652        0      0
INFO  [09:02:26.819] [bbotk]  runtime_learners                                uhash
INFO  [09:02:26.819] [bbotk]             0.521 60055aca-eaac-48eb-98f2-92365b7f1560
INFO  [09:02:26.821] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:27.502] [bbotk] Result of batch 3:
INFO  [09:02:27.505] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:27.505] [bbotk]                 0.1            0.4166667 482.9753        0      0
INFO  [09:02:27.505] [bbotk]  runtime_learners                                uhash
INFO  [09:02:27.505] [bbotk]             0.524 a8d69ff1-58d5-480e-b10f-b758684fbe45
INFO  [09:02:27.507] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:28.208] [bbotk] Result of batch 4:
INFO  [09:02:28.211] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:28.211] [bbotk]          0.09444444                 0.75 112.1054        0      0
INFO  [09:02:28.211] [bbotk]  runtime_learners                                uhash
INFO  [09:02:28.211] [bbotk]             0.537 21ed96b5-c2e9-40d9-b8f3-81c83c7c33e8
INFO  [09:02:28.214] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:28.962] [bbotk] Result of batch 5:
INFO  [09:02:28.965] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:28.965] [bbotk]          0.08333333            0.9166667 10.81856        0      0
INFO  [09:02:28.965] [bbotk]  runtime_learners                                uhash
INFO  [09:02:28.965] [bbotk]             0.581 4aded775-76d7-4927-8a03-94ce80da6cc5
INFO  [09:02:28.968] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:29.691] [bbotk] Result of batch 6:
INFO  [09:02:29.694] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:29.694] [bbotk]          0.08888889            0.9166667 10.74189        0      0
INFO  [09:02:29.694] [bbotk]  runtime_learners                                uhash
INFO  [09:02:29.694] [bbotk]              0.56 05532183-8e10-45b1-aa06-e1595768e5cd
INFO  [09:02:29.697] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:30.421] [bbotk] Result of batch 7:
INFO  [09:02:30.424] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:30.424] [bbotk]          0.07777778            0.5833333 201.8513        0      0
INFO  [09:02:30.424] [bbotk]  runtime_learners                                uhash
INFO  [09:02:30.424] [bbotk]             0.554 54057b4f-adac-4b36-97be-74d9aff7dac3
INFO  [09:02:30.427] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:31.137] [bbotk] Result of batch 8:
INFO  [09:02:31.140] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:31.140] [bbotk]          0.07222222            0.3333333 531.5255        0      0
INFO  [09:02:31.140] [bbotk]  runtime_learners                                uhash
INFO  [09:02:31.140] [bbotk]             0.542 9b10ffd2-bd0f-4ccd-a484-f650cad72243
INFO  [09:02:31.142] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:32.034] [bbotk] Result of batch 9:
INFO  [09:02:32.037] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:32.037] [bbotk]          0.06111111            0.9166667 11.17823        0      0
INFO  [09:02:32.037] [bbotk]  runtime_learners                                uhash
INFO  [09:02:32.037] [bbotk]             0.706 14707636-39e2-453d-b413-60bcbfbbe34a
INFO  [09:02:32.040] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:32.715] [bbotk] Result of batch 10:
INFO  [09:02:32.718] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:32.718] [bbotk]          0.08888889                 0.25  538.991        0      0
INFO  [09:02:32.718] [bbotk]  runtime_learners                                uhash
INFO  [09:02:32.718] [bbotk]             0.512 2ec63b6c-8897-467e-ac30-e2c883b51aae
INFO  [09:02:32.728] [bbotk] Finished optimizing after 10 evaluation(s)
INFO  [09:02:32.729] [bbotk] Result:
INFO  [09:02:32.731] [bbotk]  regr.glmnet.lambda variance.filter.frac learner_param_vals  x_domain regr.mse
INFO  [09:02:32.731] [bbotk]          0.08888889            0.9166667          &lt;list[5]&gt; &lt;list[2]&gt; 10.74189
INFO  [09:02:32.934] [bbotk] Starting to optimize 2 parameter(s) with &#39;&lt;TunerGridSearch&gt;&#39; and &#39;&lt;TerminatorEvals&gt; [n_evals=10, k=0]&#39;
INFO  [09:02:32.939] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:33.615] [bbotk] Result of batch 1:
INFO  [09:02:33.618] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:33.618] [bbotk]          0.08888889            0.5833333  12.6173        0      0
INFO  [09:02:33.618] [bbotk]  runtime_learners                                uhash
INFO  [09:02:33.618] [bbotk]             0.515 31a12c50-dae9-4bda-9dd6-5c7022d121c6
INFO  [09:02:33.620] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:34.336] [bbotk] Result of batch 2:
INFO  [09:02:34.339] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:34.339] [bbotk]                 0.1            0.5833333  12.5155        0      0
INFO  [09:02:34.339] [bbotk]  runtime_learners                                uhash
INFO  [09:02:34.339] [bbotk]              0.55 9acf1673-6bb5-43c0-96b9-25930195a730
INFO  [09:02:34.341] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:35.063] [bbotk] Result of batch 3:
INFO  [09:02:35.066] [bbotk]  regr.glmnet.lambda variance.filter.frac  regr.mse warnings errors
INFO  [09:02:35.066] [bbotk]          0.08333333                 0.75 0.9870004        0      0
INFO  [09:02:35.066] [bbotk]  runtime_learners                                uhash
INFO  [09:02:35.066] [bbotk]             0.552 d2aa4959-8784-4e3b-959f-018fe0f24d46
INFO  [09:02:35.068] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:35.750] [bbotk] Result of batch 4:
INFO  [09:02:35.753] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:35.753] [bbotk]          0.07222222                  0.5 17.75887        0      0
INFO  [09:02:35.753] [bbotk]  runtime_learners                                uhash
INFO  [09:02:35.753] [bbotk]             0.517 8510ef0c-f88b-48e0-978e-f3f5fc12119b
INFO  [09:02:35.776] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:36.486] [bbotk] Result of batch 5:
INFO  [09:02:36.489] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:36.489] [bbotk]          0.08333333            0.5833333  12.6722        0      0
INFO  [09:02:36.489] [bbotk]  runtime_learners                                uhash
INFO  [09:02:36.489] [bbotk]             0.522 68922809-e559-4f83-a339-ed85b0beaf53
INFO  [09:02:36.491] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:37.204] [bbotk] Result of batch 6:
INFO  [09:02:37.206] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:37.206] [bbotk]          0.07222222            0.5833333 12.78818        0      0
INFO  [09:02:37.206] [bbotk]  runtime_learners                                uhash
INFO  [09:02:37.206] [bbotk]             0.549 3279edfd-cbe3-41fa-9cde-1cf048f9e348
INFO  [09:02:37.209] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:37.912] [bbotk] Result of batch 7:
INFO  [09:02:37.915] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:37.915] [bbotk]          0.07777778                  0.5 17.69921        0      0
INFO  [09:02:37.915] [bbotk]  runtime_learners                                uhash
INFO  [09:02:37.915] [bbotk]             0.539 08f9f1f2-f9aa-429f-afff-3642ab1307a9
INFO  [09:02:37.917] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:38.594] [bbotk] Result of batch 8:
INFO  [09:02:38.597] [bbotk]  regr.glmnet.lambda variance.filter.frac  regr.mse warnings errors
INFO  [09:02:38.597] [bbotk]          0.07777778            0.9166667 0.9880384        0      0
INFO  [09:02:38.597] [bbotk]  runtime_learners                                uhash
INFO  [09:02:38.597] [bbotk]             0.516 03348856-344f-4aa4-a6ae-0c03f2a9074e
INFO  [09:02:38.599] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:39.310] [bbotk] Result of batch 9:
INFO  [09:02:39.312] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:39.312] [bbotk]          0.07777778            0.4166667 22.43294        0      0
INFO  [09:02:39.312] [bbotk]  runtime_learners                                uhash
INFO  [09:02:39.312] [bbotk]             0.524 948291cc-62c9-4927-aee2-62b83b8acf37
INFO  [09:02:39.315] [bbotk] Evaluating 1 configuration(s)
INFO  [09:02:40.023] [bbotk] Result of batch 10:
INFO  [09:02:40.025] [bbotk]  regr.glmnet.lambda variance.filter.frac regr.mse warnings errors
INFO  [09:02:40.025] [bbotk]          0.07222222            0.3333333 27.31378        0      0
INFO  [09:02:40.025] [bbotk]  runtime_learners                                uhash
INFO  [09:02:40.025] [bbotk]             0.543 7e1676b1-0157-4fd8-9e99-8f50bd69479c
INFO  [09:02:40.035] [bbotk] Finished optimizing after 10 evaluation(s)
INFO  [09:02:40.037] [bbotk] Result:
INFO  [09:02:40.039] [bbotk]  regr.glmnet.lambda variance.filter.frac learner_param_vals  x_domain  regr.mse
INFO  [09:02:40.039] [bbotk]          0.08333333                 0.75          &lt;list[5]&gt; &lt;list[2]&gt; 0.9870004
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">obj_dml_plr_sim_pipe</span><span class="o">$</span><span class="nf">fit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">obj_dml_plr_sim_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
================= DoubleMLPLR Object ==================


------------------ Data summary      ------------------
Outcome variable: y
Treatment variable(s): d
Covariates: X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, X16, X17, X18, X19, X20, X21, X22, X23, X24, X25, X26, X27, X28, X29, X30, X31, X32, X33, X34, X35, X36, X37, X38, X39, X40, X41, X42, X43, X44, X45, X46, X47, X48, X49, X50, X51, X52, X53, X54, X55, X56, X57, X58, X59, X60, X61, X62, X63, X64, X65, X66, X67, X68, X69, X70, X71, X72, X73, X74, X75, X76, X77, X78, X79, X80, X81, X82, X83, X84, X85, X86, X87, X88, X89, X90, X91, X92, X93, X94, X95, X96, X97, X98, X99, X100
Instrument(s):
No. Observations: 500

------------------ Score &amp; algorithm ------------------
Score function: partialling out
DML algorithm: dml2

------------------ Machine learner   ------------------
ml_l: regr.cv_glmnet
ml_m: regr.cv_glmnet

------------------ Resampling        ------------------
No. folds: 5
No. repeated sample splits: 1
Apply cross-fitting: TRUE

------------------ Fit summary       ------------------
 Estimates and significance testing of the effect of target variables
  Estimate. Std. Error t value Pr(&gt;|t|)
d   3.00133    0.04424   67.84   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


</pre></div></div>
</div>
</section>
</section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this heading">#</a></h2>
<p>Becker, M., Binder, M., Bischl, B., Lang, M., Pfisterer, F., Reich, N.G., Richter, J., Schratz, P., Sonabend, R. (2020), mlr3 book, available at <a class="reference external" href="https://mlr3book.mlr-org.com">https://mlr3book.mlr-org.com</a>.</p>
<p>Binder, M., Pfisterer, F., Lang, M., Schneider, L., Kotthof, L., and Bischl, B. (2021), mlr3pipelines - flexible machine learning pipelines in R, Journal of Machine Learning Research, 22(184): 1-7, <a class="reference external" href="https://jmlr.org/papers/v22/21-0281.html">https://jmlr.org/papers/v22/21-0281.html</a>.</p>
<p>Lang, M., Binder, M., Richter, J., Schratz, P., Pfisterer, F., Coors, S., Au, Q., Casalicchio, G., Kotthoff, L., Bischl, B. (2019), mlr3: A modern object-oriented machine learing framework in R. Journal of Open Source Software, <a class="reference external" href="https://doi.org/10.21105/joss.01903">doi:10.21105/joss.01903</a>.</p>
<p>Lang, M., Au, Q., Coors, S., and Schratz, P. (2021), mlr3learners: Recommended learners for mlr3, R package, <a class="reference external" href="https://CRAN.R-project.org/package=mlr3learners">https://CRAN.R-project.org/package=mlr3learners</a>.</p>
<p>Sonabend, R., and Schratz, P. (2021), extralearners: Extra learners for mlr3. R package, <a class="reference external" href="https://mlr3extralearners.mlr-org.com/">https://mlr3extralearners.mlr-org.com/</a>.</p>
<hr class="docutils" />
<p><strong>Acknowledgement</strong></p>
<p>We would like to thank the developers of the <a class="reference external" href="https://mlr3pipelines.mlr-org.com/">mlr3pipelines</a> package for providing such a powerful and easy-to-use implementation of many important ML tools.</p>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="py_double_ml_multiway_cluster.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Python: Cluster Robust Double Machine Learning</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="double_ml_bonus_data.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">DML: Bonus Data</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2021, Bach, P., Chernozhukov, V., Kurz, M. S., and Spindler, M..<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.0.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>